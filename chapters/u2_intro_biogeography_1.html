<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Introducción a la biogeografía filogenética con el modelo DEC – Patrones filogenéticos: macroevolución y adaptación</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/u1_intro_diversification_4.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-c6cbc1d6fb8db58f958c455fce091558.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles/custom.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/u2_intro_biogeography_1.html">Unidad 2: Patrones biogeográficos</a></li><li class="breadcrumb-item"><a href="../chapters/u2_intro_biogeography_1.html"><span class="chapter-title">Introducción a la biogeografía filogenética con el modelo DEC</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Patrones filogenéticos: macroevolución y adaptación</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Inicio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/install.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Instalación de Software</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/commandline.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Apuntes sobre comandos básicos en Bash</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/Rstudio.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Apuntes sobre R y Rstudio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/revbayes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Apuntes sobre RevBayes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/factor_bayes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Comparación de modelos mediante Factores de Bayes</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Unidad 1: Patrones de diversificación</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/u1_intro_diversification.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Introducción al proceso de diversificación</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/u1_intro_diversification_2.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Modelos con cambios en las tasas de diversificación</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/u1_intro_diversification_3.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Estimación de Eventos de Extinción Masiva</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/u1_intro_diversification_4.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Introducción a modelos State Speciaction-Extinción (SSE)</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Unidad 2: Patrones biogeográficos</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/u2_intro_biogeography_1.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Introducción a la biogeografía filogenética con el modelo DEC</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#introducción" id="toc-introducción" class="nav-link active" data-scroll-target="#introducción"><strong>Introducción</strong></a></li>
  <li><a href="#descripción-del-modelo-de-dispersión-extinción-cladogénesis-dec" id="toc-descripción-del-modelo-de-dispersión-extinción-cladogénesis-dec" class="nav-link" data-scroll-target="#descripción-del-modelo-de-dispersión-extinción-cladogénesis-dec"><strong>Descripción del Modelo de Dispersión-Extinción-Cladogénesis (DEC)</strong></a></li>
  <li><a href="#caracteres-de-rango-discretos-en-el-modelo-dec" id="toc-caracteres-de-rango-discretos-en-el-modelo-dec" class="nav-link" data-scroll-target="#caracteres-de-rango-discretos-en-el-modelo-dec"><strong>Caracteres de Rango Discretos en el Modelo DEC</strong></a></li>
  <li><a href="#definición-de-la-matriz-de-tasas-q" id="toc-definición-de-la-matriz-de-tasas-q" class="nav-link" data-scroll-target="#definición-de-la-matriz-de-tasas-q"><strong>Definición de la Matriz de Tasas (Q)</strong></a></li>
  <li><a href="#anagenesis-matriz-de-tasas-q" id="toc-anagenesis-matriz-de-tasas-q" class="nav-link" data-scroll-target="#anagenesis-matriz-de-tasas-q">Anagenesis: Matriz de tasas <span class="math inline">\(Q\)</span></a></li>
  <li><a href="#codificar-eventos-cladogenéticos-en-dec" id="toc-codificar-eventos-cladogenéticos-en-dec" class="nav-link" data-scroll-target="#codificar-eventos-cladogenéticos-en-dec">Codificar eventos cladogenéticos en DEC</a></li>
  <li><a href="#espadas-plateadas-tribu-madiinae-un-grupo-endémico-de-hawái." id="toc-espadas-plateadas-tribu-madiinae-un-grupo-endémico-de-hawái." class="nav-link" data-scroll-target="#espadas-plateadas-tribu-madiinae-un-grupo-endémico-de-hawái.">Espadas plateadas (Tribu Madiinae), un grupo endémico de Hawái.</a></li>
  <li><a href="#procesar-y-visualizar-los-resultados" id="toc-procesar-y-visualizar-los-resultados" class="nav-link" data-scroll-target="#procesar-y-visualizar-los-resultados"><strong>Procesar y visualizar los resultados</strong></a></li>
  <li><a href="#graficar-en-r-con-revgadgets" id="toc-graficar-en-r-con-revgadgets" class="nav-link" data-scroll-target="#graficar-en-r-con-revgadgets">Graficar en R con RevGadgets</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/u2_intro_biogeography_1.html">Unidad 2: Patrones biogeográficos</a></li><li class="breadcrumb-item"><a href="../chapters/u2_intro_biogeography_1.html"><span class="chapter-title">Introducción a la biogeografía filogenética con el modelo DEC</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-title">Introducción a la biogeografía filogenética con el modelo DEC</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introducción" class="level2">
<h2 class="anchored" data-anchor-id="introducción"><strong>Introducción</strong></h2>
<p>Muchos procesos evolutivos fundamentales, como la adaptación, la especiación y la extinción, ocurren en un contexto espacial. Cuando no es posible observar directamente los aspectos históricos de este contexto espacial, como sucede en la mayoría de los casos, se pueden aplicar métodos de inferencia biogeográfica para estimar los rangos ancestrales de las especies.</p>
<p>Estos métodos combinan información filogenética, molecular y geográfica para modelar la distribución de especies como el resultado de procesos biogeográficos. Sin embargo, modelar estos procesos requiere de un análisis detallado, considerando aspectos como:</p>
<ul>
<li><p>Cómo se heredan los rangos tras eventos de especiación.</p></li>
<li><p>Cómo los eventos geológicos pueden influir en las tasas de dispersión.</p></li>
<li><p>Qué factores afectan las tasas de dispersión y extirpación (extinción local).</p></li>
</ul>
<p>Uno de los principales desafíos técnicos en la modelización de la evolución de rangos geográficos es traducir estos procesos naturales en procesos estocásticos que sean manejables en un contexto de inferencia. Este tutorial proporciona una introducción a algunos de estos modelos y describe cómo realizar una inferencia bayesiana de la biogeografía histórica utilizando el modelo de <a href="https://revbayes.github.io/tutorials/biogeo/biogeo_intro.html"><strong>Dispersión-Extinción-Cladogénesis (DEC)</strong> en RevBayes</a>.</p>
</section>
<section id="descripción-del-modelo-de-dispersión-extinción-cladogénesis-dec" class="level2">
<h2 class="anchored" data-anchor-id="descripción-del-modelo-de-dispersión-extinción-cladogénesis-dec"><strong>Descripción del Modelo de Dispersión-Extinción-Cladogénesis (DEC)</strong></h2>
<p>El modelo <strong>DEC</strong> modela la evolución de rangos como un proceso discreto (Ree et al.&nbsp;2005; Ree y Smith 2008). Este modelo incluye tres componentes clave:</p>
<ol type="1">
<li><p><strong>Caracteres de Rango:</strong> Representación de la distribución de una especie como un conjunto de áreas discretas.</p></li>
<li><p><strong>Evolución Anagenética del Rango:</strong> Cambios en el rango geográfico dentro de una línea evolutiva antes de un evento de especiación.</p></li>
<li><p><strong>Evolución Cladogenética del Rango:</strong> Cambios en la distribución de la especie durante eventos de especiación.</p></li>
</ol>
<p>A continuación, se presentan los posibles eventos modelados en DEC:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ixchelgzlzr.github.io/filo_bayes_UNAM/docs/biogeo/figures/fig_range_evol_events.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="600"></p>
</figure>
</div>
<section id="eventos-anagenéticos-cambios-dentro-de-una-misma-línea-evolutiva" class="level3">
<h3 class="anchored" data-anchor-id="eventos-anagenéticos-cambios-dentro-de-una-misma-línea-evolutiva"><strong>Eventos Anagenéticos (cambios dentro de una misma línea evolutiva):</strong></h3>
<ul>
<li><p><strong>(a) Dispersión:</strong> Una especie expande su rango al colonizar una nueva área.</p></li>
<li><p><strong>(b) Extirpación (o extinción local):</strong> Una especie pierde una de sus áreas previamente habitadas.</p></li>
</ul>
</section>
<section id="eventos-cladogenéticos-cambios-en-la-distribución-durante-la-especiación" class="level3">
<h3 class="anchored" data-anchor-id="eventos-cladogenéticos-cambios-en-la-distribución-durante-la-especiación"><strong>Eventos Cladogenéticos (cambios en la distribución durante la especiación):</strong></h3>
<ul>
<li><p><strong>(c) Simpatría restringida:</strong> Si el ancestro estaba restringido a un solo territorio, ambas especies descendientes heredan esa misma área.</p></li>
<li><p><strong>(d) Simpatría parcial:</strong> Si el ancestro tenía un rango amplio, una de las especies descendientes hereda el rango ancestral, mientras que la otra se restringe a una sola de sus áreas.</p></li>
<li><p><strong>(e) Alopatría (o vicarianza):</strong> Si el ancestro tenía un rango amplio, cada especie descendiente hereda un subconjunto diferente de ese rango.</p></li>
<li><p><strong>(f) Simpatría generalizada:</strong> Ambas especies descendientes heredan el mismo rango amplio del ancestro.</p></li>
<li><p><strong>(g) Dispersión por salto (o especiación fundadora):</strong> Una especie descendiente hereda el rango ancestral mientras que la otra coloniza una nueva área previamente no ocupada.</p></li>
</ul>
<p>Estos eventos permiten modelar de manera realista cómo evolucionan las distribuciones geográficas a lo largo del tiempo en un contexto filogenético.</p>
</section>
</section>
<section id="caracteres-de-rango-discretos-en-el-modelo-dec" class="level2">
<h2 class="anchored" data-anchor-id="caracteres-de-rango-discretos-en-el-modelo-dec"><strong>Caracteres de Rango Discretos en el Modelo DEC</strong></h2>
<p>El modelo <strong>DEC</strong> interpreta los rangos de los taxones como <strong>datos de presencia-ausencia</strong>. Es decir, representa en qué áreas una especie está presente o ausente a lo largo de múltiples regiones discretas.</p>
<p>Por ejemplo, supongamos que trabajamos con tres áreas geográficas: <strong>A, B y C</strong>.<br>
Si una especie se encuentra en las áreas <strong>A y C</strong>, su rango se puede representar como <strong>AC</strong>. Este rango se codifica mediante un <strong>vector binario de longitud 3</strong>, donde:</p>
<ul>
<li><p><strong>1</strong> indica presencia en un área.</p></li>
<li><p><strong>0</strong> indica ausencia en un área.</p></li>
</ul>
<p>Para el rango <strong>AC</strong>, la representación en bits sería <code>101</code>. Esta notación también puede transformarse en un número entero utilizando su representación binaria:</p>
<ul>
<li><code>101</code> en binario equivale a <strong>5</strong> en decimal.</li>
</ul>
<section id="ejemplo-de-representaciones-discretas-de-rangos" class="level3">
<h3 class="anchored" data-anchor-id="ejemplo-de-representaciones-discretas-de-rangos"><strong>Ejemplo de Representaciones Discretas de Rangos</strong></h3>
<p>A continuación, se muestra cómo se representan distintos rangos para un análisis con tres áreas (<strong>A, B y C</strong>):</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><strong>Rango</strong></th>
<th><strong>Bits</strong></th>
<th><strong>Número de áreas</strong></th>
<th><strong>Valor entero</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>(vacío)</td>
<td><code>000</code></td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>A</td>
<td><code>100</code></td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>B</td>
<td><code>010</code></td>
<td>1</td>
<td>2</td>
</tr>
<tr class="even">
<td>C</td>
<td><code>001</code></td>
<td>1</td>
<td>3</td>
</tr>
<tr class="odd">
<td>AB</td>
<td><code>110</code></td>
<td>2</td>
<td>4</td>
</tr>
<tr class="even">
<td>AC</td>
<td><code>101</code></td>
<td>2</td>
<td>5</td>
</tr>
<tr class="odd">
<td>BC</td>
<td><code>011</code></td>
<td>2</td>
<td>6</td>
</tr>
<tr class="even">
<td>ABC</td>
<td><code>111</code></td>
<td>3</td>
<td>7</td>
</tr>
</tbody>
</table>
</section>
<section id="evolución-anagenética-del-rango-en-el-modelo-dec" class="level3">
<h3 class="anchored" data-anchor-id="evolución-anagenética-del-rango-en-el-modelo-dec"><strong>Evolución Anagenética del Rango en el Modelo DEC</strong></h3>
<p>La <strong>anagénesis</strong> se refiere a la evolución de los rangos geográficos que ocurre <strong>entre eventos de especiación</strong>, es decir, dentro de una misma línea evolutiva.</p>
<p>Existen dos tipos principales de eventos anagenéticos:</p>
<ol type="1">
<li><p><strong>Dispersión (Figura 1a):</strong> Ocurre cuando una especie coloniza una nueva área.</p></li>
<li><p><strong>Extirpación o extinción local (Figura 1b):</strong> Ocurre cuando una especie pierde una de sus áreas previamente ocupadas.</p></li>
</ol>
<p>Dado que el modelo DEC usa rangos discretos, la anagénesis se modela utilizando una <strong>cadena de Markov de tiempo continuo (CTMC)</strong>. En este modelo:</p>
<ul>
<li><p>La probabilidad de que un rango cambie de estado (de <span class="math inline">\(i\)</span> a <span class="math inline">\(j\)</span>) en un tiempo <span class="math inline">\(t\)</span> se calcula mediante <strong>exponenciación de matrices</strong>, según la ecuación:</p>
<p><span class="math display">\[ P_{ij}(t) = [exp(Qt)]_{ij} \]</span></p></li>
</ul>
<p>donde:</p>
<ul>
<li><p><span class="math inline">\(Q\)</span> es la <strong>matriz de tasas instantáneas</strong>, que define las tasas de cambio entre todos los pares de estados.</p></li>
<li><p><span class="math inline">\(P\)</span> es la <strong>matriz de probabilidad de transición</strong>.</p></li>
<li><p><span class="math inline">\(i\)</span> y <span class="math inline">\(j\)</span> representan diferentes rangos, los cuales se codifican como conjuntos de áreas ocupadas por una especie.</p></li>
<li><p>La probabilidad <strong>integra todas las posibles trayectorias</strong> de cambios de estado en el tiempo <span class="math inline">\(t\)</span>.</p></li>
</ul>
</section>
</section>
<section id="definición-de-la-matriz-de-tasas-q" class="level2">
<h2 class="anchored" data-anchor-id="definición-de-la-matriz-de-tasas-q"><strong>Definición de la Matriz de Tasas (Q)</strong></h2>
<p>Podemos definir la matriz <span class="math inline">\(Q\)</span> de anagénesis en términos de tasas de <strong>extinción local (</strong><span class="math inline">\(e\)</span>) y <strong>dispersión (</strong><span class="math inline">\(d\)</span>). Para tres áreas geográficas (<span class="math inline">\(A\)</span>, <span class="math inline">\(B\)</span>, <span class="math inline">\(C\)</span>), la matriz de tasas de evolución anagenética tiene la siguiente estructura:</p>
<p><span class="math display">\[
Q =
\begin{array}{c|cccccccc}
   &amp; \emptyset &amp; A &amp; B &amp; C &amp; AB &amp; AC &amp; BC &amp; ABC \\
\hline
\emptyset &amp; - &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
A &amp; e_A &amp; - &amp; 0 &amp; 0 &amp; d_{AB} &amp; d_{AC} &amp; 0 &amp; 0 \\
B &amp; e_B&amp; 0 &amp; - &amp; 0 &amp; d_{BA} &amp; 0 &amp; d_{BC} &amp; 0 \\
C &amp; e_C &amp; 0 &amp; 0 &amp; - &amp; 0 &amp; d_{CA} &amp; d_{CB} &amp; 0 \\
AB &amp; 0 &amp; e_B &amp; e_A &amp; 0 &amp; - &amp; 0 &amp; 0 &amp; d_{AC} + d_{BC} \\
AC &amp; 0 &amp; e_C &amp; 0 &amp; e_A &amp; 0 &amp; - &amp; 0 &amp; d_{AB} + d_{CB} \\
BC &amp; 0 &amp; 0 &amp; e_C &amp; e_B &amp; 0 &amp; 0 &amp; - &amp; d_{BA} + d_{CA} \\
ABC &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; e_C &amp; e_B &amp; e_A &amp; - \\
\end{array}
\]</span></p>
<p>donde:</p>
<ul>
<li><p><span class="math inline">\(e = (eA, eB, eC)\)</span> representan las tasas de extinción local por área.</p></li>
<li><p><span class="math inline">\(d = (dAB, dAC, dBC, dBA, dCA, dCB)\)</span> representan las tasas de dispersión entre pares de áreas.</p></li>
<li><p><strong>El rango vacío (</strong><span class="math inline">\(∅\)</span>) es un estado absorbente: cualquier linaje que pierda todas sus áreas se mantiene en ese estado de manera permanente.</p></li>
</ul>
<section id="construcción-de-una-matriz-de-tasa-dec-en-revbayes." class="level3">
<h3 class="anchored" data-anchor-id="construcción-de-una-matriz-de-tasa-dec-en-revbayes.">🧠 Construcción de una matriz de tasa DEC en RevBayes.</h3>
<p>Ejecutar en <code>rb</code> los siguientes comandos:</p>
<p>Definir el número de áreas:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>n_areas <span class="ot">&lt;-</span> <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="anagenesis-matriz-de-tasas-q" class="level2">
<h2 class="anchored" data-anchor-id="anagenesis-matriz-de-tasas-q">Anagenesis: Matriz de tasas <span class="math inline">\(Q\)</span></h2>
<p>Matriz de dispersión:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_areas) {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_areas) {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>        dr[i][j] <span class="ot">&lt;-</span> <span class="fl">1.0</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>¿Qué está haciendo este código?</strong></p>
<ol type="1">
<li><p>Se define una <strong>matriz cuadrada</strong> de tamaño <span class="math inline">\(3x3\)</span> (porque hay 3 áreas).</p></li>
<li><p>Se llena con <span class="math inline">\(1.0\)</span> en todas las posiciones <span class="math inline">\(dr[i][j]\)</span>, lo que significa <strong>que todas las áreas están conectadas por igual</strong>.</p></li>
<li><p>Se asume que la dispersión <strong>no depende de la dirección</strong> (<code>A → B</code> es igual que <code>B → A</code>).</p></li>
</ol>
<p><strong>Matriz de dispersión:</strong></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_areas) {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_areas) {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        dr[i][j] <span class="ot">&lt;-</span> <span class="fl">1.0</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>¿Qué está haciendo este código?</strong></p>
<ol type="1">
<li><p>Se define una <strong>matriz cuadrada</strong> de tamaño <span class="math inline">\(3x3\)</span> (porque hay 3 áreas).</p></li>
<li><p>Se llena con <span class="math inline">\(1.0\)</span> en todas las posiciones <span class="math inline">\(dr[i][j]\)</span>, lo que significa <strong>que todas las áreas están conectadas por igual</strong>.</p></li>
<li><p>Se asume que la dispersión <strong>no depende de la dirección</strong> (<code>A → B</code> es igual que <code>B → A</code>).</p></li>
</ol>
<p><strong>Matriz de extirpación:</strong></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_areas) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_areas) {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        er[i][j] <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    er[i][i] <span class="ot">&lt;-</span> <span class="fl">1.0</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>¿Qué está haciendo este código?</strong></p>
<ol type="1">
<li><p>Se define una <strong>matriz cuadrada</strong> de tamaño <span class="math inline">\(3x3\)</span> (porque hay 3 áreas).</p></li>
<li><p>Inicializa toda la matriz <span class="math inline">\(er\)</span> con 0.0 <strong>(asumiendo que no hay extirpación entre diferentes áreas)</strong>.</p></li>
<li><p>Pone <span class="math inline">\(1.0\)</span> en la diagonal de la matriz <span class="math inline">\((A → ∅, B → ∅, C → ∅)\)</span>.</p></li>
<li><p>Esto significa que cada área tiene una <strong>tasa de extirpación de 1.0</strong> por sí misma.</p></li>
<li><p><strong>No hay extirpación cruzada</strong> (<span class="math inline">\(A → B\)</span> no ocurre, solo <span class="math inline">\(A → ∅\)</span>).</p></li>
</ol>
<p><strong>Crear la matriz Q_DEC:</strong></p>
<p>Con las matrices <code>dr</code> y <code>er</code> creadas, ahora vas a construir la <strong>matriz Q_DEC</strong>, que define <strong>las tasas de cambio entre todos los estados posibles de rango geográfico</strong>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>Q_DEC <span class="sc">:</span><span class="er">=</span> <span class="fu">fnDECRateMatrix</span>(<span class="at">dispersalRates=</span>dr, <span class="at">extirpationRates=</span>er)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>Q_DEC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Esto hace lo siguiente:</p>
<ul>
<li><p>Calcula automáticamente las <strong>64 combinaciones</strong> de transiciones posibles entre los <strong>8 estados</strong> (con 3 áreas, hay <span class="math inline">\(2^3 = 8\)</span> estados).</p></li>
<li><p>Llena la matriz <code>Q_DEC (8x8)</code> con tasas basadas en:</p>
<ul>
<li><p>La matriz de <strong>dispersión</strong> <code>dr</code>: para agregar áreas al rango actual.</p></li>
<li><p>La matriz de <strong>extirpación</strong> <code>er</code>: para quitar áreas del rango actual.</p></li>
</ul></li>
</ul>
<p><strong>Crear la matriz de probabilidades de transición:</strong></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>tp_DEC <span class="ot">&lt;-</span> <span class="fu">Q_DEC.getTransitionProbabilities</span>(<span class="at">rate=</span><span class="fl">0.2</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>tp_DEC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Estás calculando la matriz de probabilidades de transición a lo largo de una rama del árbol de longitud 0.2 unidades de tiempo (por ejemplo, millones de años).</p>
<p><strong>Veamos esta fila:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 26%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th>De <code>A</code> hacia…</th>
<th><code>A</code></th>
<th><code>B</code></th>
<th><code>C</code></th>
<th><code>AB</code></th>
<th><code>AC</code></th>
<th><code>BC</code></th>
<th><code>ABC</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Probabilidad</strong></td>
<td>0.673</td>
<td>0.013</td>
<td>0.013</td>
<td>0.123</td>
<td>0.123</td>
<td>0.005</td>
<td>0.050</td>
</tr>
</tbody>
</table>
<p>Esto responde: Si la especie está en <code>A</code>, qué tan probable es que termine en esos otros estados después de tiempo <code>t = 0.2</code>?</p>
<p><strong>En resumen</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 24%">
<col style="width: 32%">
<col style="width: 42%">
</colgroup>
<thead>
<tr class="header">
<th>Comparación</th>
<th><code>Q_DEC</code></th>
<th><code>tp_DEC</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>¿Qué es?</td>
<td>Matriz de tasas</td>
<td>Matriz de probabilidades</td>
</tr>
<tr class="even">
<td>¿Qué mide?</td>
<td>Velocidad de cambio instantáneo</td>
<td>Probabilidad de cambio tras cierto tiempo</td>
</tr>
<tr class="odd">
<td>¿Depende del tiempo?</td>
<td>❌ No</td>
<td>✅ Sí</td>
</tr>
<tr class="even">
<td>¿Cómo se calcula?</td>
<td>Directamente de <code>dr</code> y <code>er</code></td>
<td>Usando exp⁡(Q⋅t)exp(Q⋅t)</td>
</tr>
<tr class="odd">
<td>¿Para qué se usa?</td>
<td>Construir el modelo DEC</td>
<td>Simular evolución, inferir cambios</td>
</tr>
</tbody>
</table>
</section>
<section id="codificar-eventos-cladogenéticos-en-dec" class="level2">
<h2 class="anchored" data-anchor-id="codificar-eventos-cladogenéticos-en-dec">Codificar eventos cladogenéticos en DEC</h2>
<p>Cuando una especie se divide en dos nuevas especies (cladogénesis), su rango geográfico también se hereda de diferentes formas.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>clado_event_types <span class="ot">=</span> [ <span class="st">"s"</span>, <span class="st">"a"</span> ]</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>clado_event_probs <span class="ot">&lt;-</span> <span class="fu">simplex</span>( <span class="dv">1</span>, <span class="dv">1</span> )</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>P_DEC <span class="sc">:</span><span class="er">=</span> <span class="fu">fnDECCladoProbs</span>(<span class="at">eventProbs=</span>clado_event_probs,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">eventTypes=</span>clado_event_types,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">numCharacters=</span>n_areas)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol type="1">
<li><code>clado_event_types = [ "s", "a" ]</code></li>
</ol>
<p>Define <strong>qué tipos de eventos cladogenéticos</strong> vas a permitir en el modelo.</p>
<ul>
<li><p><code>"s"</code> = <strong>Subset sympatry</strong><br>
Una especie hereda <strong>todo el rango</strong>, la otra solo <strong>una parte</strong> (un área individual).<br>
Ejemplo: <code>ABC → (ABC, A)</code></p></li>
<li><p><code>"a"</code> = <strong>Allopatry</strong><br>
El rango se <strong>divide</strong> en dos partes complementarias.<br>
Ejemplo: <code>ABC → (AB, C)</code></p></li>
</ul>
<ol start="2" type="1">
<li><code>clado_event_probs &lt;- simplex(1, 1)</code></li>
</ol>
<p>Esto crea un vector de <strong>probabilidades normalizadas</strong> (que suman 1).</p>
<p>📌 Como pusiste <code>1, 1</code>, estás diciendo:</p>
<ul>
<li><p><code>"s"</code> tendrá <strong>50% de probabilidad</strong></p></li>
<li><p><code>"a"</code> tendrá <strong>50% de probabilidad</strong></p></li>
</ul>
<p>💡 Si hubieras puesto <code>simplex(2, 1)</code>, la probabilidad sería:</p>
<ul>
<li><p><code>"s"</code> = 2/3</p></li>
<li><p><code>"a"</code> = 1/3</p></li>
</ul>
<ol start="3" type="1">
<li><code>P_DEC := fnDECCladoProbs(...)</code></li>
</ol>
<p>Esta función genera la <strong>matriz de probabilidades cladogenéticas</strong>, combinando los tipos de eventos (<code>"s"</code>, <code>"a"</code>) con sus probabilidades (<code>50%-50%</code>), para todos los <strong>estados posibles</strong> del rango, de acuerdo al número de áreas (<code>n_areas</code>).</p>
<p>📊 <strong>¿Qué incluye <code>P_DEC</code>?</strong></p>
<p>Una matriz <strong>sparse</strong> (dispersa) donde cada fila representa:</p>
<p><code>(estado_ancestral → sp_izquierda, sp_derecha) = probabilidad</code></p>
<p>Ejemplo:</p>
<p><code>(7 -&gt; 7, 1) = 0.0833  # ABC → (ABC, A)  ← subset sympatry</code></p>
<p><code>(7 -&gt; 6, 1) = 0.0833  # ABC → (AB, A)   ← allopatry</code></p>
<p><code>(7 -&gt; 4, 3) = 0.0833  # ABC → (A, BC)   ← allopatry</code></p>
<p>Como usaste <code>"s"</code> y <code>"a"</code> con probabilidades iguales, <strong>se reparten equitativamente</strong> entre todos los eventos posibles válidos bajo cada categoría.</p>
<section id="aspectos-clave-a-considerar" class="level3">
<h3 class="anchored" data-anchor-id="aspectos-clave-a-considerar">⚠️ <strong>Aspectos clave a considerar</strong></h3>
<ul>
<li><p>El modelo DEC escala <strong>exponencialmente</strong> con el número de áreas:</p>
<ul>
<li><p><span class="math inline">\(3\)</span> áreas → 8×8 anagenético, <span class="math inline">\(8^3 = 512\)</span> eventos cladogenéticos</p></li>
<li><p><span class="math inline">\(10\)</span> áreas → <span class="math inline">\(1024 × 1024\)</span> (ya es muy pesado)</p></li>
<li><p><span class="math inline">\(20\)</span> áreas → ¡matrices enormes! No viable computacionalmente.</p></li>
</ul></li>
</ul>
</section>
</section>
<section id="espadas-plateadas-tribu-madiinae-un-grupo-endémico-de-hawái." class="level2">
<h2 class="anchored" data-anchor-id="espadas-plateadas-tribu-madiinae-un-grupo-endémico-de-hawái.">Espadas plateadas (Tribu Madiinae), un grupo endémico de Hawái.</h2>
<ul>
<li><p>Un grupo joven (~5 millones de años) y diverso de ~50 especies/subespecies</p></li>
<li><p>Se originaron en el continente (EE.UU. occidental), pero <strong>radiaron en las islas hawaianas</strong></p></li>
<li><p>Son ideales para estudios porque:</p>
<ul>
<li><p>Las islas hawaianas se formaron de manera <strong>cronológica</strong> (K → O → M → H)</p></li>
<li><p>Hay buen registro de distribución y filogenia.</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://revbayes.github.io/tutorials/biogeo/figures/fig_hawaii_areas.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="550"></p>
</figure>
</div></li>
</ul>
<p>🗺️ <strong>Áreas geográficas usadas</strong></p>
<p>Para simplificar, el tutorial usa solo <strong>4 áreas</strong> (con posibles combinaciones):</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Código binario</th>
<th>Áreas</th>
<th>Tamaño</th>
<th>Estado (índice)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>0000</code></td>
<td>Ninguna (∅)</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td><code>1000</code></td>
<td>K (Kauai/Nihoa)</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td><code>0100</code></td>
<td>O (Oahu)</td>
<td>1</td>
<td>2</td>
</tr>
<tr class="even">
<td><code>0010</code></td>
<td>M (Maui Nui)</td>
<td>1</td>
<td>3</td>
</tr>
<tr class="odd">
<td><code>0001</code></td>
<td>H (Hawai‘i)</td>
<td>1</td>
<td>4</td>
</tr>
<tr class="even">
<td><code>1100</code></td>
<td>KO</td>
<td>2</td>
<td>5</td>
</tr>
<tr class="odd">
<td><code>1010</code></td>
<td>KM</td>
<td>2</td>
<td>6</td>
</tr>
<tr class="even">
<td><code>0110</code></td>
<td>OM</td>
<td>2</td>
<td>7</td>
</tr>
<tr class="odd">
<td><code>1001</code></td>
<td>KH</td>
<td>2</td>
<td>8</td>
</tr>
<tr class="even">
<td><code>0101</code></td>
<td>OH</td>
<td>2</td>
<td>9</td>
</tr>
<tr class="odd">
<td><code>0011</code></td>
<td>MH</td>
<td>2</td>
<td>10</td>
</tr>
<tr class="even">
<td><code>1110</code></td>
<td>KOM</td>
<td>3</td>
<td>11</td>
</tr>
<tr class="odd">
<td><code>1101</code></td>
<td>KOH</td>
<td>3</td>
<td>12</td>
</tr>
<tr class="even">
<td><code>1011</code></td>
<td>KMH</td>
<td>3</td>
<td>13</td>
</tr>
<tr class="odd">
<td><code>0111</code></td>
<td>OMH</td>
<td>3</td>
<td>14</td>
</tr>
<tr class="even">
<td><code>1111</code></td>
<td>KOMH</td>
<td>4</td>
<td>15</td>
</tr>
</tbody>
</table>
<p>📌 Cada uno de estos estados representa un <strong>rango posible</strong> que puede ocupar una especie.</p>
<p><strong>Descargar los archivos necesarios</strong></p>
<p><a href="../docs/u2_PatBio/silversword.tre" download="">📥 Descargar Árbol Filogenético</a></p>
<p><a href="../docs/u2_PatBio/silversword.n4.range.nex" download="">📥 Descargar matriz de datos con los rangos codificados de cada especie.</a></p>
<p><strong>Crea un scrip para RevBayes y copia el siguiente codigo.</strong></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># definir rutas de los archivos y ruta de salida</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>range_fn <span class="ot">=</span> <span class="st">"../data/silversword.n4.range.nex"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>tree_fn  <span class="ot">=</span> <span class="st">"../data/silversword.tre"</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>out_fn   <span class="ot">=</span> <span class="st">"../output/DEC/simple"</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># leer datos de presencia-ausencia (binarios 0/1) de los rangos geográficos</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>dat_range_01 <span class="ot">=</span> <span class="fu">readDiscreteCharacterData</span>(range_fn)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># convertir los rangos binarios en números naturales (formato requerido por DEC)</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>dat_range_n <span class="ot">=</span> <span class="fu">formatDiscreteCharacterData</span>(dat_range_01, <span class="st">"DEC"</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># comparar los caracteres (rangos) de dos taxones</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>dat_range_01[<span class="dv">1</span>]</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>dat_range_n[<span class="dv">1</span>]</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># dimensiones de los datos (número de áreas y estados posibles)</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>n_areas  <span class="ot">=</span> <span class="fu">dat_range_01.nchar</span>()</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>n_states <span class="ot">=</span> <span class="fu">floor</span>(<span class="dv">2</span><span class="sc">^</span>n_areas)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="co"># obtener las descripciones de los estados convertidos</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>state_desc <span class="ot">=</span> <span class="fu">dat_range_n.getStateDescriptions</span>()</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="co"># escribir las descripciones de los estados en un archivo</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>state_desc_str <span class="ot">=</span> <span class="st">"state,range</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">state_desc.size</span>())</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    state_desc_str <span class="sc">+</span><span class="er">=</span> (i<span class="dv">-1</span>) <span class="sc">+</span> <span class="st">","</span> <span class="sc">+</span> state_desc[i] <span class="sc">+</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="fu">write</span>(state_desc_str, <span class="at">file=</span>out_fn<span class="sc">+</span><span class="st">".state_labels.txt"</span>)</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="co"># variables auxiliares (para guardar movimientos, monitores y número de generaciones)</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>moves <span class="ot">=</span> <span class="fu">VectorMoves</span>()</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>monitors <span class="ot">=</span> <span class="fu">VectorMonitors</span>()</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>n_gen <span class="ot">=</span> <span class="dv">3000</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelos del árbol filogenético #</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a><span class="co"># leer el árbol filogenético</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>tree <span class="ot">&lt;-</span> <span class="fu">readTrees</span>(tree_fn)[<span class="dv">1</span>]</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="do">##########################</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelos biogeográficos #</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a><span class="do">##########################</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="co"># multiplicador de la tasa de eventos biogeográficos</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>rate_bg <span class="sc">~</span> <span class="fu">dnLoguniform</span>(<span class="fl">1E-4</span>,<span class="fl">1E2</span>)</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a><span class="fu">rate_bg.setValue</span>(<span class="fl">1E-2</span>)</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a><span class="fu">moves.append</span>( <span class="fu">mvScale</span>(rate_bg, <span class="at">weight=</span><span class="dv">4</span>) )</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a><span class="co"># tasa de dispersión relativa</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>dispersal_rate <span class="ot">&lt;-</span> <span class="fl">1.0</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a><span class="co"># construir la matriz de tasas de dispersión relativa</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_areas) {</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_areas) {</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>        dr[i][j] <span class="ot">&lt;-</span> dispersal_rate</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a><span class="co"># luego, definir la tasa de extirpación (extinción local) relativa por área</span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>log_sd <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>log_mean <span class="ot">&lt;-</span> <span class="fu">ln</span>(<span class="dv">1</span>) <span class="sc">-</span> <span class="fl">0.5</span><span class="sc">*</span>log_sd<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>extirpation_rate <span class="sc">~</span> <span class="fu">dnLognormal</span>(<span class="at">mean=</span>log_mean, <span class="at">sd=</span>log_sd)</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a><span class="fu">moves.append</span>( <span class="fu">mvScale</span>(extirpation_rate, <span class="at">weight=</span><span class="dv">2</span>) )</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a><span class="co"># construir la matriz de tasas de extirpación relativa</span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_areas) {</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_areas) {</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>        er[i][j] <span class="ot">&lt;-</span> <span class="fl">0.0</span>       </span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>    er[i][i] <span class="sc">:</span><span class="er">=</span> extirpation_rate</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a><span class="co"># construir la matriz de tasas del modelo DEC (Q)</span></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>Q_DEC <span class="sc">:</span><span class="er">=</span> <span class="fu">fnDECRateMatrix</span>(<span class="at">dispersalRates=</span>dr,</span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>                         <span class="at">extirpationRates=</span>er)</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>                           </span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a><span class="co"># construir la matriz de probabilidades de eventos cladogenéticos</span></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>clado_event_types <span class="ot">&lt;-</span> [ <span class="st">"s"</span>, <span class="st">"a"</span> ]</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>clado_event_probs <span class="ot">&lt;-</span> <span class="fu">simplex</span>(<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>P_DEC <span class="sc">:</span><span class="er">=</span> <span class="fu">fnDECCladoProbs</span>(<span class="at">eventProbs=</span>clado_event_probs,</span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>                         <span class="at">eventTypes=</span>clado_event_types,</span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>                         <span class="at">numCharacters=</span>n_areas)</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a><span class="co"># modelo de cadena de Markov continua (CTMC) filogenética con eventos cladogenéticos</span></span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>m_bg <span class="sc">~</span> <span class="fu">dnPhyloCTMCClado</span>(<span class="at">tree=</span>tree,</span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Q=</span>Q_DEC,</span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>                           <span class="at">cladoProbs=</span>P_DEC,</span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>                           <span class="at">branchRates=</span>rate_bg,</span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>                           <span class="at">type=</span><span class="st">"NaturalNumbers"</span>,</span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>                           <span class="at">nSites=</span><span class="dv">1</span>)</span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a><span class="co"># fijar (clamp) los datos observados de rangos al modelo</span></span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a><span class="fu">m_bg.clamp</span>(dat_range_n)</span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a><span class="do">#############</span></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a><span class="co"># Monitores #</span></span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a><span class="do">#############</span></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a><span class="fu">monitors.append</span>( <span class="fu">mnScreen</span>(<span class="at">printgen=</span><span class="dv">100</span>, rate_bg) )</span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a><span class="fu">monitors.append</span>( <span class="fu">mnModel</span>(<span class="at">file=</span>out_fn<span class="sc">+</span><span class="st">".model.log"</span>, <span class="at">printgen=</span><span class="dv">10</span>) )</span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a><span class="fu">monitors.append</span>( <span class="fu">mnFile</span>(tree, <span class="at">filename=</span>out_fn<span class="sc">+</span><span class="st">".tre"</span>, <span class="at">printgen=</span><span class="dv">10</span>) )</span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a><span class="fu">monitors.append</span>( <span class="fu">mnJointConditionalAncestralState</span>(<span class="at">tree=</span>tree,</span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">ctmc=</span>m_bg,</span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">type=</span><span class="st">"NaturalNumbers"</span>,</span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">withTips=</span>true,</span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">withStartStates=</span>true,</span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">filename=</span>out_fn<span class="sc">+</span><span class="st">".states.log"</span>,</span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">printgen=</span><span class="dv">10</span>) )</span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a><span class="fu">monitors.append</span>( <span class="fu">mnStochasticCharacterMap</span>(<span class="at">ctmc=</span>m_bg,</span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">filename=</span>out_fn<span class="sc">+</span><span class="st">".stoch.log"</span>,</span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">printgen=</span><span class="dv">100</span>) )</span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a><span class="do">############</span></span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a><span class="co"># Análisis #</span></span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a><span class="do">############</span></span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a><span class="co"># construir el objeto de análisis del modelo a partir del grafo del modelo</span></span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a>mymodel <span class="ot">=</span> <span class="fu">model</span>(m_bg)</span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a><span class="co"># crear el objeto de análisis MCMC</span></span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a>mymcmc <span class="ot">=</span> <span class="fu">mcmc</span>(mymodel, monitors, moves)</span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a><span class="co"># ejecutar el análisis MCMC</span></span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a><span class="fu">mymcmc.run</span>(n_gen)</span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a><span class="co"># salir de revbayes</span></span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a><span class="fu">quit</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="procesar-y-visualizar-los-resultados" class="level2">
<h2 class="anchored" data-anchor-id="procesar-y-visualizar-los-resultados"><strong>Procesar y visualizar los resultados</strong></h2>
<p>Paso 1: Abre una nueva sesión de RevBayes y crea variables con los nombres de los archivos generados:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>out_str <span class="ot">=</span> <span class="st">"../output/DEC/simple"</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>out_state_fn <span class="ot">=</span> out_str <span class="sc">+</span> <span class="st">".states.log"</span>   <span class="co"># Archivo con los estados ancestrales</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>out_tree_fn  <span class="ot">=</span> out_str <span class="sc">+</span> <span class="st">".tre"</span>          <span class="co"># Árboles muestreados del posterior</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>out_mcc_fn   <span class="ot">=</span> out_str <span class="sc">+</span> <span class="st">".mcc.tre"</span>      <span class="co"># Árbol de máxima credibilidad</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Paso 2: Este paso <strong>resume los árboles del posterior</strong> (salvando la variabilidad) en <strong>un solo árbol representativo</strong>, útil para visualizar:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>tree_trace <span class="ot">=</span> <span class="fu">readTreeTrace</span>(<span class="at">file=</span>out_tree_fn, <span class="at">treetype=</span><span class="st">"clock"</span>)  <span class="co"># Leer los árboles</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tree_trace.setBurnin</span>(<span class="fl">0.25</span>)          <span class="co"># Eliminar 25% como burn-in</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>n_burn <span class="ot">=</span> <span class="fu">tree_trace.getBurnin</span>()     <span class="co"># Guardar el número de árboles descartados</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>💡 Aunque en este análisis usaste un árbol fijo, este paso es <strong>importante cuando el árbol se infiere</strong> y varía entre muestras (ej. posterior bayesiano completo).</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>mcc_tree <span class="ot">=</span> <span class="fu">mccTree</span>(tree_trace, <span class="at">file=</span>out_mcc_fn)  <span class="co"># Crear y guardar el árbol MCC</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Paso 3: Cargar los estados ancestrales reconstruidos</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>state_trace <span class="ot">=</span> <span class="fu">readAncestralStateTrace</span>(<span class="at">file=</span>out_state_fn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Este archivo contiene las <strong>probabilidades posteriores de los estados en los nodos</strong> del árbol.</p>
<p>Paso 4: Cargar los árboles anotados con estados ancestrales</p>
<p>⚠️ Aquí es importante usar <code>readAncestralStateTreeTrace</code> y <strong>no</strong> <code>readTreeTrace</code>, para mantener las anotaciones:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>tree_trace <span class="ot">=</span> <span class="fu">readAncestralStateTreeTrace</span>(<span class="at">file=</span>out_tree_fn, <span class="at">treetype=</span><span class="st">"clock"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Paso 5: Generar el árbol con estados ancestrales</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>anc_tree <span class="ot">=</span> <span class="fu">ancestralStateTree</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">tree=</span>mcc_tree,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">ancestral_state_trace_vector=</span>state_trace,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">tree_trace=</span>tree_trace,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">include_start_states=</span>true,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">file=</span>out_str <span class="sc">+</span> <span class="st">".ase.tre"</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">burnin=</span>n_burn,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">site=</span><span class="dv">1</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="graficar-en-r-con-revgadgets" class="level2">
<h2 class="anchored" data-anchor-id="graficar-en-r-con-revgadgets">Graficar en R con RevGadgets</h2>
<ul>
<li><p><strong>Abre un editor de texto</strong> (ejemplo <em>VSCode</em> )</p></li>
<li><p><strong>Copia y pega</strong> exactamente el siguiente contenido</p></li>
<li><p><strong>Guarda el archivo</strong> dentro de la carpeta de resultados de tu análisis DEC con el nombre `range_colors.txt`</p></li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>range,color</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="st">"K"</span>,<span class="st">"#7570b3"</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="st">"O"</span>,<span class="st">"#e7298a"</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="st">"M"</span>,<span class="st">"#66a61e"</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="st">"H"</span>,<span class="st">"#e6ab02"</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="st">"KO"</span>,<span class="st">"orchid"</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="st">"KM"</span>,<span class="st">"firebrick3"</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="st">"OM"</span>,<span class="st">"green"</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="st">"KH"</span>,<span class="st">"cyan"</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="st">"OH"</span>,<span class="st">"cadetblue3"</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="st">"MH"</span>,<span class="st">"tomato"</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="st">"KOM"</span>,<span class="st">"aquamarine2"</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="st">"KOH"</span>,<span class="st">"#d95f02"</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="st">"KMH"</span>,<span class="st">"royalblue"</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="st">"OMH"</span>,<span class="st">"#666666"</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="st">"KOMH"</span>,<span class="st">"darkviolet"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Este script define dos funciones auxiliares que se usan para <strong>visualizar los resultados</strong> de un análisis de biogeografía (por ejemplo, con el modelo DEC), específicamente para:</p>
<ul>
<li><p>Mostrar los <strong>estados ancestrales</strong> como gráficos de pastel (pie charts) sobre el árbol filogenético.</p></li>
<li><p>Añadir <strong>información geológica</strong>, como los tiempos de formación de las islas hawaianas, sobre el eje temporal del árbol.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar las bibliotecas necesarias</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RevGadgets)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggtree)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Función para añadir líneas verticales que marcan los tiempos de formación de las islas</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>add_island_times <span class="ot">=</span> <span class="cf">function</span>(p, x_offset) {</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    t <span class="ot">=</span> <span class="st">"dashed"</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">=</span> p <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept=</span>x_offset<span class="fl">-5.05</span>, <span class="at">color=</span><span class="st">"#7570b3"</span>, <span class="at">linetype=</span>t)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">=</span> p <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept=</span>x_offset<span class="fl">-5.15</span>, <span class="at">color=</span><span class="st">"#7570b3"</span>, <span class="at">linetype=</span>t)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">=</span> p <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept=</span>x_offset<span class="fl">-2.2</span>, <span class="at">color=</span><span class="st">"#e7298a"</span>, <span class="at">linetype=</span>t)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">=</span> p <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept=</span>x_offset<span class="fl">-3.7</span>, <span class="at">color=</span><span class="st">"#e7298a"</span>, <span class="at">linetype=</span>t)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">=</span> p <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept=</span>x_offset<span class="fl">-1.3</span>, <span class="at">color=</span><span class="st">"#66a61e"</span>, <span class="at">linetype=</span>t)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">=</span> p <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept=</span>x_offset<span class="fl">-1.8</span>, <span class="at">color=</span><span class="st">"#66a61e"</span>, <span class="at">linetype=</span>t)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">=</span> p <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept=</span>x_offset<span class="fl">-0.3</span>, <span class="at">color=</span><span class="st">"#e6ab02"</span>, <span class="at">linetype=</span>t)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">=</span> p <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept=</span>x_offset<span class="fl">-0.7</span>, <span class="at">color=</span><span class="st">"#e6ab02"</span>, <span class="at">linetype=</span>t)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(p)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Función para construir etiquetas y colores de los estados ancestrales</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>make_states <span class="ot">=</span> <span class="cf">function</span>(label_fn, color_fn, <span class="at">fp=</span><span class="st">"./"</span>) {</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Leer la tabla de colores para cada rango geográfico</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    range_color_list <span class="ot">=</span> <span class="fu">read.csv</span>(color_fn, <span class="at">header=</span>T, <span class="at">sep=</span><span class="st">","</span>, <span class="at">colClasses=</span><span class="st">"character"</span>)</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extraer los nombres de las áreas individuales (por ejemplo: "K", "O", "M", "H")</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    area_names <span class="ot">=</span> <span class="fu">unlist</span>(<span class="fu">sapply</span>(range_color_list<span class="sc">$</span>range, <span class="cf">function</span>(y) { <span class="cf">if</span> (<span class="fu">nchar</span>(y)<span class="sc">==</span><span class="dv">1</span>) { <span class="fu">return</span>(y) } }))</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Leer el archivo con las etiquetas de los estados codificados (binarios)</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    state_descriptions <span class="ot">=</span> <span class="fu">read.csv</span>(label_fn, <span class="at">header=</span>T, <span class="at">sep=</span><span class="st">","</span>, <span class="at">colClasses=</span><span class="st">"character"</span>)</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convertir los rangos codificados como "1010" en nombres como "KM"</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>    range_labels <span class="ot">=</span> <span class="fu">sapply</span>(state_descriptions<span class="sc">$</span>range[<span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(state_descriptions)],</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(x) {</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>            present <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">gregexpr</span>(<span class="at">pattern=</span><span class="st">"1"</span>, x)[[<span class="dv">1</span>]])</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste</span>( area_names[present], <span class="at">collapse=</span><span class="st">""</span>)</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Asignar un color a cada rango</span></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>    range_colors <span class="ot">=</span> range_color_list<span class="sc">$</span>color[ <span class="fu">match</span>(range_labels, range_color_list<span class="sc">$</span>range) ]</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generar listas con las etiquetas y los colores por estado</span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>    idx <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>    st_lbl <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>    st_colors <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(state_descriptions)<span class="sc">-</span><span class="dv">1</span>)) {</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>        st_lbl[[ <span class="fu">as.character</span>(j) ]] <span class="ot">=</span> range_labels[j]</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>        st_colors[j] <span class="ot">=</span> range_colors[j]</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Añadir color para estados misceláneos o desconocidos</span></span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>    st_colors[ <span class="fu">length</span>(st_colors)<span class="sc">+</span><span class="dv">1</span> ] <span class="ot">=</span> <span class="st">"lightgray"</span></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>    st_lbl[[<span class="st">"misc."</span>]] <span class="ot">=</span> <span class="st">"misc."</span></span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Devolver etiquetas y colores</span></span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>( <span class="fu">list</span>(<span class="at">state_labels=</span>st_lbl, <span class="at">state_colors=</span>st_colors) )</span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Este script en R <strong>genera una figura</strong> que muestra un árbol filogenético anotado con los <strong>estados ancestrales geográficos</strong>(rango de distribución de cada nodo) inferidos con el modelo DEC en RevBayes. Utiliza gráficos de pastel (pie charts) para representar <strong>la incertidumbre en la reconstrucción</strong> de rangos geográficos a lo largo del árbol evolutivo, y añade <strong>información temporal sobre la formación de las islas hawaianas</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># nombres de archivo</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># archivo de salida para la figura final en PDF</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>plot_fn <span class="ot">=</span> <span class="st">"../docs/u2_PatBio/output/DEC/simple.range.pdf"</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># árbol con estados ancestrales (generado en RevBayes)</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>tree_fn <span class="ot">=</span> <span class="st">"../docs/u2_PatBio/output/DEC/simple.ase.tre"</span> </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># archivo con las etiquetas de los estados (rango binario → etiquetas)</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>label_fn <span class="ot">=</span> <span class="st">"../docs/u2_PatBio/output/DEC/simple.state_labels.txt"</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># archivo con los colores para cada rango</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>color_fn <span class="ot">=</span> <span class="st">"../docs/u2_PatBio/output/DEC/range_colors.txt"</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co"># obtener etiquetas de estado y colores de estado</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>states <span class="ot">=</span> <span class="fu">make_states</span>(label_fn, color_fn)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>state_labels <span class="ot">=</span> states<span class="sc">$</span>state_labels</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>state_colors <span class="ot">=</span> states<span class="sc">$</span>state_colors</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co"># procesar los estados ancestrales</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>ase <span class="ot">&lt;-</span> <span class="fu">processAncStates</span>(tree_fn,</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># Estas etiquetas numéricas deben coincidir con</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># las del archivo original de datos de entrada.</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>                        <span class="at">state_labels =</span> state_labels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  |                                              
  |                                        |   0%
  |                                              
  |========================================| 100%</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># graficar los estados ancestrales como gráficos de pastel (pie charts)</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>pp  <span class="ot">&lt;-</span> <span class="fu">plotAncStatesPie</span>(<span class="at">t =</span> ase,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># incluir los estados del nodo raíz</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">include_start_states=</span>T, </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># mostrar etiquetas de los estados</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">state_labels=</span>state_labels,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># asignar los colores definidos</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">state_colors=</span>state_colors, </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># tamaño de las etiquetas en los extremos (tips)</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">tip_label_size=</span><span class="fl">2.5</span>,</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># distancia de desplazamiento de las etiquetas</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">tip_label_offset=</span><span class="fl">0.1</span>,</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># sin etiquetas numéricas en los nodos</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">node_label_size=</span><span class="dv">0</span>, </span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># sin etiquetas en los hombros</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">shoulder_label_size=</span><span class="dv">0</span>, </span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># mostrar leyenda de probabilidades posteriores</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>                         <span class="at">show_posterior_legend=</span>T, </span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># tamaño de los círculos en los extremos (tips)</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>                         <span class="at">tip_pie_diameter=</span><span class="fl">0.5</span>, </span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># tamaño de los círculos en los nodos</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>                         <span class="at">node_pie_diameter=</span><span class="fl">2.0</span>,</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># ajuste horizontal de los gráficos de pastel</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pie_nudge_x=</span><span class="fl">0.03</span>, </span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># ajuste vertical de los gráficos de pastel</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pie_nudge_y=</span><span class="fl">0.16</span>, </span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>                         <span class="at">alpha=</span><span class="dv">1</span>) <span class="sc">+</span> <span class="co"># opacidad</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mover la leyenda de estados</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.75</span>))</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a><span class="co"># obtener las dimensiones del gráfico</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a> <span class="co"># obtener el valor máximo del eje x (altura del árbol)</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>x_phy <span class="ot">=</span> <span class="fu">max</span>(pp<span class="sc">$</span>data<span class="sc">$</span>x)</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a> <span class="co"># espacio extra para las etiquetas de las hojas</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>x_label <span class="ot">=</span> <span class="fl">3.5</span> </span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a> <span class="co"># edad inicial del eje (debe ser mayor a la raíz del árbol)</span></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>x_start <span class="ot">=</span> <span class="dv">7</span>  </span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a><span class="co"># inicio del eje x</span></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>x0 <span class="ot">=</span> <span class="sc">-</span>(x_start <span class="sc">-</span> x_phy) </span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a><span class="co"># fin del eje x</span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">=</span> x_phy <span class="sc">+</span> x_label </span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a><span class="co"># añadir eje cronológico</span></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>pp <span class="ot">=</span> pp <span class="sc">+</span> <span class="fu">theme_tree2</span>()</span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>pp <span class="ot">=</span> pp <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Edad (Ma)"</span>)</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a><span class="co"># modificar límites del eje x</span></span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>pp <span class="ot">=</span> pp <span class="sc">+</span> <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(x0,x1), <span class="at">expand=</span><span class="cn">TRUE</span>)</span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a><span class="co"># agregar marcas al eje y etiquetas de islas como eje secundario</span></span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>island_axis <span class="ot">=</span> <span class="fu">sec_axis</span>(<span class="sc">~</span> ., <span class="at">breaks=</span>x_phy<span class="sc">-</span><span class="fu">c</span>(<span class="fl">5.1</span>, <span class="fl">2.95</span>, <span class="fl">1.55</span>, <span class="fl">0.5</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"+K"</span>,<span class="st">"+O"</span>,<span class="st">"+M"</span>,<span class="st">"+H"</span>) )</span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>x_breaks <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>,x_start,<span class="dv">1</span>) <span class="sc">+</span> x0</span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>x_labels <span class="ot">=</span> <span class="fu">rev</span>(<span class="fu">seq</span>(<span class="dv">0</span>,x_start,<span class="dv">1</span>))</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>pp <span class="ot">=</span> pp <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span>x_breaks, <span class="at">labels=</span>x_labels, <span class="at">sec.axis=</span>island_axis)</span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a><span class="co"># dibujar líneas verticales que marcan los tiempos de formación de islas</span></span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>pp <span class="ot">=</span> <span class="fu">add_island_times</span>(pp, x_phy)</span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a><span class="co"># configurar la posición de la leyenda</span></span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>pp <span class="ot">=</span> pp <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"left"</span>)</span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a><span class="co"># mostrar gráfico final</span></span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>pp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="u2_intro_biogeography_1_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># guardar el gráfico como archivo PDF</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">file=</span>plot_fn, <span class="at">plot=</span>pp, <span class="at">device=</span><span class="st">"pdf"</span>, <span class="at">height=</span><span class="dv">7</span>, <span class="at">width=</span><span class="dv">10</span>, <span class="at">useDingbats=</span>F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/u1_intro_diversification_4.html" class="pagination-link" aria-label="Introducción a modelos State Speciaction-Extinción (SSE)">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Introducción a modelos State Speciaction-Extinción (SSE)</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




</body></html>