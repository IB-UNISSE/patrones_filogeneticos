<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Introducción a modelos State Speciaction-Extinción (SSE) – Patrones filogenéticos: macroevolución y adaptación</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/u1_intro_diversification_3.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-c6cbc1d6fb8db58f958c455fce091558.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles/custom.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/u1_intro_diversification.html">Unidad 1: Patrones de diversificación</a></li><li class="breadcrumb-item"><a href="../chapters/u1_intro_diversification_4.html"><span class="chapter-title">Introducción a modelos State Speciaction-Extinción (SSE)</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Patrones filogenéticos: macroevolución y adaptación</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Inicio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/install.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Instalación de Software</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/commandline.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Apuntes sobre comandos básicos en Bash</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/Rstudio.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Apuntes sobre R y Rstudio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/revbayes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Apuntes sobre RevBayes</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Unidad 1: Patrones de diversificación</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/u1_intro_diversification.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Introducción al proceso de diversificación</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/u1_intro_diversification_2.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Modelos con cambios en las tasas de diversificación</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/u1_intro_diversification_3.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Estimación de Eventos de Extinción Masiva</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/u1_intro_diversification_4.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Introducción a modelos State Speciaction-Extinción (SSE)</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#presentación-introducción-a-modelos-state-speciaction-extinción-sse" id="toc-presentación-introducción-a-modelos-state-speciaction-extinción-sse" class="nav-link active" data-scroll-target="#presentación-introducción-a-modelos-state-speciaction-extinción-sse">Presentación: Introducción a modelos State Speciaction-Extinción (SSE)</a></li>
  <li><a href="#modelo-bisse-binary-state-speciation-and-extinction-madisson-et-al.-2007" id="toc-modelo-bisse-binary-state-speciation-and-extinction-madisson-et-al.-2007" class="nav-link" data-scroll-target="#modelo-bisse-binary-state-speciation-and-extinction-madisson-et-al.-2007">Modelo BiSSE (Binary state speciation and extinction, Madisson et al.&nbsp;2007)</a>
  <ul class="collapse">
  <li><a href="#descarga-del-árbol-filogenético-y-la-matriz-codificada" id="toc-descarga-del-árbol-filogenético-y-la-matriz-codificada" class="nav-link" data-scroll-target="#descarga-del-árbol-filogenético-y-la-matriz-codificada">Descarga del Árbol Filogenético y la matriz codificada</a></li>
  <li><a href="#carga-de-la-filogenia-y-los-datos" id="toc-carga-de-la-filogenia-y-los-datos" class="nav-link" data-scroll-target="#carga-de-la-filogenia-y-los-datos">Carga de la filogenia y los datos</a></li>
  <li><a href="#define-el-número-de-estados-en-los-modelos-biss" id="toc-define-el-número-de-estados-en-los-modelos-biss" class="nav-link" data-scroll-target="#define-el-número-de-estados-en-los-modelos-biss">Define el número de estados en los modelos BiSS</a></li>
  <li><a href="#definir-vectores-para-almacenar-los-movimientos-de-mcmc-y-los-monitores-de-resultados." id="toc-definir-vectores-para-almacenar-los-movimientos-de-mcmc-y-los-monitores-de-resultados." class="nav-link" data-scroll-target="#definir-vectores-para-almacenar-los-movimientos-de-mcmc-y-los-monitores-de-resultados.">Definir vectores para almacenar los movimientos de MCMC y los monitores de resultados.</a></li>
  <li><a href="#valores-de-la-log-normal" id="toc-valores-de-la-log-normal" class="nav-link" data-scroll-target="#valores-de-la-log-normal">Valores de la log-normal</a></li>
  <li><a href="#definir-la-matriz-de-tasas-de-transición-entre-los-estados-del-carácter" id="toc-definir-la-matriz-de-tasas-de-transición-entre-los-estados-del-carácter" class="nav-link" data-scroll-target="#definir-la-matriz-de-tasas-de-transición-entre-los-estados-del-carácter">Definir la <strong>matriz de tasas de transición</strong> entre los estados del carácter</a></li>
  <li><a href="#definición-de-las-tasas-de-transición" id="toc-definición-de-las-tasas-de-transición" class="nav-link" data-scroll-target="#definición-de-las-tasas-de-transición">Definición de las tasas de transición</a></li>
  <li><a href="#creación-de-la-matriz-de-tasas-de-transición" id="toc-creación-de-la-matriz-de-tasas-de-transición" class="nav-link" data-scroll-target="#creación-de-la-matriz-de-tasas-de-transición">Creación de la matriz de tasas de transición</a></li>
  <li><a href="#frecuencias-del-estado-en-la-raíz" id="toc-frecuencias-del-estado-en-la-raíz" class="nav-link" data-scroll-target="#frecuencias-del-estado-en-la-raíz">Frecuencias del estado en la raíz</a></li>
  <li><a href="#fijar-la-edad-de-la-raíz" id="toc-fijar-la-edad-de-la-raíz" class="nav-link" data-scroll-target="#fijar-la-edad-de-la-raíz">Fijar la edad de la raíz</a></li>
  <li><a href="#definir-rho-proporción-de-especies-muestreadas" id="toc-definir-rho-proporción-de-especies-muestreadas" class="nav-link" data-scroll-target="#definir-rho-proporción-de-especies-muestreadas">Definir <span class="math inline">\(\rho\)</span> : Proporción de especies muestreadas</a></li>
  <li><a href="#construcción-del-árbol-evolutivo-generado-a-partir-de-un-proceso-de-nacimiento-y-muerte-dependiente-del-carácter" id="toc-construcción-del-árbol-evolutivo-generado-a-partir-de-un-proceso-de-nacimiento-y-muerte-dependiente-del-carácter" class="nav-link" data-scroll-target="#construcción-del-árbol-evolutivo-generado-a-partir-de-un-proceso-de-nacimiento-y-muerte-dependiente-del-carácter">Construcción del árbol evolutivo generado a partir de un proceso de nacimiento y muerte dependiente del carácter</a></li>
  <li><a href="#fijar-clamp-los-datos-observados" id="toc-fijar-clamp-los-datos-observados" class="nav-link" data-scroll-target="#fijar-clamp-los-datos-observados">Fijar (<code>clamp</code>) los datos observados</a></li>
  <li><a href="#creación-del-modelo" id="toc-creación-del-modelo" class="nav-link" data-scroll-target="#creación-del-modelo">Creación del modelo</a></li>
  <li><a href="#configuración-de-los-monitores" id="toc-configuración-de-los-monitores" class="nav-link" data-scroll-target="#configuración-de-los-monitores">Configuración de los monitores</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/u1_intro_diversification.html">Unidad 1: Patrones de diversificación</a></li><li class="breadcrumb-item"><a href="../chapters/u1_intro_diversification_4.html"><span class="chapter-title">Introducción a modelos State Speciaction-Extinción (SSE)</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-title">Introducción a modelos State Speciaction-Extinción (SSE)</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="presentación-introducción-a-modelos-state-speciaction-extinción-sse" class="level1">
<h1>Presentación: Introducción a modelos State Speciaction-Extinción (SSE)</h1>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../docs/u1_PatDiv/5_ModSSE.pdf"><img src="../images/u1_PatDiv/u1_PatDiv_5.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="500"></a></p>
</figure>
</div>
<p>Haz clic en la imagen para ver el PDF de la presentación</p>
<p>Analizaremos si las tasas de diversificación están asociadas al tipo de hospedero en los escarabajos meloidos (Meloidae). Las subfamilias Nemognathinae y Meloinae presentan un ciclo de vida complejo, caracterizado por múltiples metamorfosis y estrategias de parasitoidismo. La mayoría de los géneros y tribus dentro de estas subfamilias son parasitoides de abejas, incluyendo especies foréticas y no foréticas. Sin embargo, dos tribus han adoptado una estrategia distinta, alimentándose de huevos de saltamontes. Estas diferencias en las estrategias de vida están asociadas con marcadas variaciones en la riqueza de especies entre clados (<a href="https://onlinelibrary.wiley.com/doi/full/10.1111/mec.16390">López-Estrada et al., 2019</a>).</p>
</section>
<section id="modelo-bisse-binary-state-speciation-and-extinction-madisson-et-al.-2007" class="level1">
<h1>Modelo BiSSE (Binary state speciation and extinction, <a href="https://academic.oup.com/sysbio/article/56/5/701/1694265">Madisson et al.&nbsp;2007</a>)</h1>
<p>BiSSE el modelo de especiación y extinción dependendiente de un caracter binario y es un proceso estocástico que se forma de la composición de dos procesos de nacimiento y muerte. Los dos procesos se conectan a través de dos tasas de cambio conocidas como las tasas de transición. El supuesto más importante del modelo BiSSE es que cada estado tiene su propia tasa de especiación <span class="math inline">\(\lambda\)</span> y su propia tasa de extinción <span class="math inline">\(\mu\)</span> que representan el momento en el cuál un linaje se divide en dos o se extingue. Este es un supuesto muy importante porque la implicación es que la acumulación (o la falta de acumulación) de linajes es el resultado del valor del estado. Pueden encontrar mas información en el material del taller <a href="https://ixchelgzlzr.github.io/filo_bayes_UNAM/">Filo-Bayes</a> - <a href="https://ixchelgzlzr.github.io/filo_bayes_UNAM/docs/discrete/SSEmodels.html">BISSE</a>.</p>
<p><strong>Escarabajos meloidos</strong></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/u1_PatDiv/u1_PatDiv_6.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="550"></p>
</figure>
</div>
<p>Las transiciones entre estados ocurren a tasas <span class="math inline">\(q_{01}\)</span> (de abeja a saltamontes) y <span class="math inline">\(q_{10}\)</span> (de saltamontes a abeja). Cada estado tiene su propia tasa de especiación (<span class="math inline">\(\lambda_0, \lambda_1\)</span>) y extinción (<span class="math inline">\(\mu_0, \mu_1\)</span>).</p>
<p><strong>Matriz de tasas de transición (</strong><span class="math inline">\(Q\)</span>)</p>
<p>La matriz de transición <span class="math inline">\(Q\)</span> define la probabilidad de cambio entre estados en un tiempo infinitesimal:</p>
<p><span class="math display">\[
Q =
\begin{bmatrix}
  -q_{01} &amp; q_{01} \\
  q_{10} &amp; -q_{10}
\end{bmatrix}
\]</span></p>
<p>Donde:</p>
<ul>
<li><p><span class="math inline">\(q_{01}\)</span>: es la tasa de transición de hospedero abeja a hospedero saltamontes.</p></li>
<li><p><span class="math inline">\(q_{10}\)</span>: es la tasa de transición de hospedero saltamontes a hospedero abeja.</p></li>
<li><p>La diagonal contiene los valores negativos de las tasas de salida de cada estado (<span class="math inline">\(-q_{01}\)</span> y <span class="math inline">\(-q_{10}\)</span>), de modo que cada fila suma cero.</p></li>
</ul>
<p><strong>Parámetros en el modelo BiSSE</strong></p>
<p>El modelo incluye seis parámetros fundamentales:</p>
<ul>
<li><p><span class="math inline">\(\lambda_0\)</span>: tasa de especiación en el estado 0 (hospedero abeja)</p></li>
<li><p><span class="math inline">\(\lambda_1\)</span>: tasa de especiación en el estado 1 (hospedero saltamontes)</p></li>
<li><p><span class="math inline">\(\mu_0\)</span>: tasa de extinción en el estado 0</p></li>
<li><p><span class="math inline">\(\mu_1\)</span>: tasa de extinción en el estado 1</p></li>
<li><p><span class="math inline">\(q_{01}\)</span>: tasa de cambio de hospedero abeja a hospedero saltamontes</p></li>
<li><p><span class="math inline">\(q_{10}\)</span>: tasa de cambio de hospedero saltamontes a hospedero abeja</p></li>
</ul>
<section id="descarga-del-árbol-filogenético-y-la-matriz-codificada" class="level2">
<h2 class="anchored" data-anchor-id="descarga-del-árbol-filogenético-y-la-matriz-codificada">Descarga del Árbol Filogenético y la matriz codificada</h2>
<p>📥 Puedes descargar el archivo <strong>.tre</strong> con el árbol en el siguiente enlace:</p>
<p><a href="../docs/u1_PatDiv/ConLyttini.tre" download="">📥 Descargar Árbol Filogenético</a></p>
<p>📥 Puedes descargar el archivo <strong>.nex</strong> con la matriz codificada en el siguiente enlace:</p>
<p><a href="../docs/u1_PatDiv/Traits_conLyttini_01.nex" download="">📥 Descargar Matriz Codificada</a></p>
<p>Guarda los archivos en la carpeta correspondiente y verifica su ubicación antes de continuar.</p>
</section>
<section id="carga-de-la-filogenia-y-los-datos" class="level2">
<h2 class="anchored" data-anchor-id="carga-de-la-filogenia-y-los-datos">Carga de la filogenia y los datos</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Leer el arbol</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="fu">readTrees</span>(<span class="st">"../data/bisse_hisse/ConLyttini.tre"</span>)[<span class="dv">1</span>]</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Leer la matriz de caracteres</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">readCharacterData</span>(<span class="st">"../data/bisse_hisse/Traits_conLyttini_01.nex"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="define-el-número-de-estados-en-los-modelos-biss" class="level2">
<h2 class="anchored" data-anchor-id="define-el-número-de-estados-en-los-modelos-biss">Define el número de estados en los modelos BiSS</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>NUM_STATES <span class="ot">=</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="definir-vectores-para-almacenar-los-movimientos-de-mcmc-y-los-monitores-de-resultados." class="level2">
<h2 class="anchored" data-anchor-id="definir-vectores-para-almacenar-los-movimientos-de-mcmc-y-los-monitores-de-resultados.">Definir vectores para almacenar los movimientos de MCMC y los monitores de resultados.</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>moves    <span class="ot">=</span> <span class="fu">VectorMoves</span>()</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>monitors <span class="ot">=</span> <span class="fu">VectorMonitors</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="valores-de-la-log-normal" class="level2">
<h2 class="anchored" data-anchor-id="valores-de-la-log-normal">Valores de la log-normal</h2>
<p>De acuerdo con Nee et al.&nbsp;(1994) el número esperado de linajes en la corona de un clado con <code>n</code> taxones bajo un proceso de nacimiento y muerte en el tiempo <code>t</code> es:</p>
<p><span class="math inline">\((\lambda - \mu) = \frac{In(n)/2}{t}\)</span></p>
<p>En donde: <code>n</code> = es el número de especies y <code>t</code> = es la edad de la filogenia</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Definimos una a priori log normal</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>rate_mean <span class="ot">&lt;-</span> <span class="fu">ln</span>(<span class="fu">ln</span>(<span class="fl">3000.0</span><span class="sc">/</span><span class="fl">2.0</span>) <span class="sc">/</span> <span class="fu">T.rootAge</span>())</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Con una varianza que es amplia</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>rate_sd <span class="ot">&lt;-</span> <span class="fl">0.587405</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NUM_STATES) {</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># lognormales de las especiaciones</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  log_speciation[i] <span class="sc">~</span> <span class="fu">dnNormal</span>(<span class="at">mean=</span>rate_mean, <span class="at">sd=</span>rate_sd) </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  speciation[i] <span class="sc">:</span><span class="er">=</span> <span class="fu">exp</span>(log_speciation[i])</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">moves.append</span>(<span class="fu">mvSlide</span>(log_speciation[i], <span class="at">delta=</span><span class="fl">0.20</span>, <span class="at">tune=</span>true, <span class="at">weight=</span><span class="fl">3.0</span>))</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># lognormales de las extinciones</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  log_extinction[i] <span class="sc">~</span> <span class="fu">dnNormal</span>(<span class="at">mean=</span>rate_mean, <span class="at">sd=</span>rate_sd)  </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  extinction[i] <span class="sc">:</span><span class="er">=</span> <span class="fu">exp</span>(log_extinction[i])</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">moves.append</span>(<span class="fu">mvSlide</span>(log_extinction[i], <span class="at">delta=</span><span class="fl">0.20</span>, <span class="at">tune=</span>true, <span class="at">weight=</span><span class="fl">3.0</span>))</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="definir-la-matriz-de-tasas-de-transición-entre-los-estados-del-carácter" class="level2">
<h2 class="anchored" data-anchor-id="definir-la-matriz-de-tasas-de-transición-entre-los-estados-del-carácter">Definir la <strong>matriz de tasas de transición</strong> entre los estados del carácter</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcula la suma de todas las longitudes de las ramas del árbol filogenético</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Dividido por 10: Esto asume que en promedio ocurren 10 cambios de estado a lo largo del árbol</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>rate_pr <span class="sc">:</span><span class="er">=</span> <span class="fu">T.treeLength</span>() <span class="sc">/</span> <span class="dv">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="definición-de-las-tasas-de-transición" class="level2">
<h2 class="anchored" data-anchor-id="definición-de-las-tasas-de-transición">Definición de las tasas de transición</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tasa de transición de estado 1 → estado 2 </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>rate_12 <span class="sc">~</span> <span class="fu">dnExp</span>(rate_pr)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Tasa de transición de estado 2 → estado 1 </span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>rate_21 <span class="sc">~</span> <span class="fu">dnExp</span>(rate_pr)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Definición de movimientos </span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">moves.append</span>(<span class="fu">mvScale</span>(rate_12, <span class="at">weight=</span><span class="dv">2</span>))</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">moves.append</span>(<span class="fu">mvScale</span>(rate_21, <span class="at">weight=</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>¿Por qué usar una exponencial?</strong></p>
<ul>
<li><p>La distribución exponencial es adecuada para modelar <strong>tasas de transición</strong> porque impone la condición de que siempre sean <strong>positivas</strong>.</p></li>
<li><p>También asigna <strong>mayor probabilidad a valores pequeños</strong>, lo que significa que los cambios de estado no ocurren demasiado rápido.</p></li>
</ul>
</section>
<section id="creación-de-la-matriz-de-tasas-de-transición" class="level2">
<h2 class="anchored" data-anchor-id="creación-de-la-matriz-de-tasas-de-transición">Creación de la matriz de tasas de transición</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>rate_matrix <span class="sc">:</span><span class="er">=</span> <span class="fu">fnFreeBinary</span>([rate_12, rate_21 ], <span class="at">rescaled=</span>false)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="frecuencias-del-estado-en-la-raíz" class="level2">
<h2 class="anchored" data-anchor-id="frecuencias-del-estado-en-la-raíz">Frecuencias del estado en la raíz</h2>
<div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>rate_category_prior <span class="sc">~</span> <span class="fu">dnDirichlet</span>(<span class="fu">rep</span>(<span class="dv">1</span>,NUM_STATES))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">moves.append</span>(<span class="fu">mvDirichletSimplex</span>(rate_category_prior, <span class="at">tune=</span>true, <span class="at">weight=</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="fijar-la-edad-de-la-raíz" class="level2">
<h2 class="anchored" data-anchor-id="fijar-la-edad-de-la-raíz">Fijar la edad de la raíz</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>root <span class="ot">&lt;-</span> <span class="fu">T.rootAge</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="definir-rho-proporción-de-especies-muestreadas" class="level2">
<h2 class="anchored" data-anchor-id="definir-rho-proporción-de-especies-muestreadas">Definir <span class="math inline">\(\rho\)</span> : Proporción de especies muestreadas</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="fu">T.ntips</span>()<span class="sc">/</span><span class="dv">3000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="construcción-del-árbol-evolutivo-generado-a-partir-de-un-proceso-de-nacimiento-y-muerte-dependiente-del-carácter" class="level2">
<h2 class="anchored" data-anchor-id="construcción-del-árbol-evolutivo-generado-a-partir-de-un-proceso-de-nacimiento-y-muerte-dependiente-del-carácter">Construcción del árbol evolutivo generado a partir de un proceso de nacimiento y muerte dependiente del carácter</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>timetree <span class="sc">~</span> <span class="fu">dnCDBDP</span>( <span class="at">rootAge           =</span> root,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">speciationRates   =</span> speciation,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">extinctionRates   =</span> extinction, </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">Q                 =</span> rate_matrix,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">pi                =</span> rate_category_prior,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">delta             =</span> <span class="fl">1.0</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">rho               =</span> rho,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">condition         =</span> <span class="st">"time"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>🔹 <strong>Parámetros del proceso de nacimiento y muerte (<code>dnCDBDP</code>)</strong>:</p>
<ul>
<li><p><strong><code>rootAge = root</code></strong> → Se fija la edad de la raíz usando <code>root = T.rootAge()</code>.</p></li>
<li><p><strong><code>speciationRates = speciation</code></strong> → Se usa la tasa de especiación (<code>λ</code>).</p></li>
<li><p><strong><code>extinctionRates = extinction</code></strong> → Se usa la tasa de extinción (<code>μ</code>).</p></li>
<li><p><strong><code>Q = rate_matrix</code></strong> → Usa la <strong>matriz de tasas de transición</strong> de caracteres (<code>rate_12</code>, <code>rate_21</code>).</p></li>
<li><p><strong><code>pi = rate_category_prior</code></strong> → Usa la distribución <strong>a priori</strong> de los estados en la raíz.</p></li>
<li><p><strong><code>delta = 1.0</code></strong> → Parámetro de ajuste para la distribución de tiempos de especiación/extinción.</p></li>
<li><p><strong><code>rho = rho</code></strong> → Probabilidad de muestreo de especies (<code>rho = T.ntips()/3000</code>).</p></li>
<li><p><strong><code>condition = "time"</code></strong> → Condiciona el proceso a un tiempo de raíz fijo.</p></li>
</ul>
</section>
<section id="fijar-clamp-los-datos-observados" class="level2">
<h2 class="anchored" data-anchor-id="fijar-clamp-los-datos-observados">Fijar (<code>clamp</code>) los datos observados</h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">timetree.clamp</span>(T)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">timetree.clampCharData</span>(datos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="creación-del-modelo" class="level2">
<h2 class="anchored" data-anchor-id="creación-del-modelo">Creación del modelo</h2>
<div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">### workspace model wrapper </span><span class="al">###</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>mymodel <span class="ot">=</span> <span class="fu">model</span>(rate_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="configuración-de-los-monitores" class="level2">
<h2 class="anchored" data-anchor-id="configuración-de-los-monitores">Configuración de los monitores</h2>
<p>Los <strong>monitores</strong> guardan los resultados en archivos o los imprimen en pantalla.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">monitors.append</span>(<span class="fu">mnModel</span>(<span class="at">filename=</span><span class="st">"../output/mitos_BiSSE_clyttini.log"</span>, <span class="at">printgen=</span><span class="dv">1</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">monitors.append</span>(<span class="fu">mnJointConditionalAncestralState</span>(<span class="at">tree=</span>timetree, <span class="at">cdbdp=</span>timetree, <span class="at">type=</span><span class="st">"Standard"</span>, <span class="at">printgen=</span><span class="dv">1</span>, <span class="at">withTips=</span>true, <span class="at">withStartStates=</span>false, <span class="at">filename=</span><span class="st">"../output/anc_states_MITOS_BiSSE_clyttini.log"</span>))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">monitors.append</span>(<span class="fu">mnStochasticCharacterMap</span>(<span class="at">cdbdp=</span>timetree, <span class="at">printgen=</span><span class="dv">10</span>, <span class="at">filename=</span><span class="st">"../output/SCHM_BiSSE_clyttini.log"</span>))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">monitors.append</span>(<span class="fu">mnScreen</span>(<span class="at">printgen=</span><span class="dv">10</span>, rate_12, rate_21, speciation, extinction))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/u1_intro_diversification_3.html" class="pagination-link" aria-label="Estimación de Eventos de Extinción Masiva">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Estimación de Eventos de Extinción Masiva</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




</body></html>