<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Introducción a modelos State Speciaction-Extinción (SSE) – Patrones filogenéticos: macroevolución y adaptación</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/u2_intro_biogeography_1.html" rel="next">
<link href="../chapters/u1_intro_diversification_3.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-c6cbc1d6fb8db58f958c455fce091558.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles/custom.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/u1_intro_diversification.html">Unidad 1: Patrones de diversificación</a></li><li class="breadcrumb-item"><a href="../chapters/u1_intro_diversification_4.html"><span class="chapter-title">Introducción a modelos State Speciaction-Extinción (SSE)</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Patrones filogenéticos: macroevolución y adaptación</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Inicio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/install.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Instalación de Software</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/commandline.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Apuntes sobre comandos básicos en Bash</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/Rstudio.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Apuntes sobre R y Rstudio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/revbayes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Apuntes sobre RevBayes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/factor_bayes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Comparación de modelos mediante Factores de Bayes</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Unidad 1: Patrones de diversificación</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/u1_intro_diversification.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Introducción al proceso de diversificación</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/u1_intro_diversification_2.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Modelos con cambios en las tasas de diversificación</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/u1_intro_diversification_3.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Estimación de Eventos de Extinción Masiva</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/u1_intro_diversification_4.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Introducción a modelos State Speciaction-Extinción (SSE)</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Unidad 2: Patrones biogeográficos</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/u2_intro_biogeography_1.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Introducción a la biogeografía filogenética con el modelo DEC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/u2_intro_biogeography_2.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Biogeografía Bayesiana de Islas (BIB)</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#presentación-introducción-a-modelos-state-speciaction-extinción-sse" id="toc-presentación-introducción-a-modelos-state-speciaction-extinción-sse" class="nav-link active" data-scroll-target="#presentación-introducción-a-modelos-state-speciaction-extinción-sse">Presentación: Introducción a modelos State Speciaction-Extinción (SSE)</a></li>
  <li><a href="#modelo-bisse-binary-state-speciation-and-extinction-madisson-et-al.-2007" id="toc-modelo-bisse-binary-state-speciation-and-extinction-madisson-et-al.-2007" class="nav-link" data-scroll-target="#modelo-bisse-binary-state-speciation-and-extinction-madisson-et-al.-2007">Modelo BiSSE (Binary state speciation and extinction, Madisson et al.&nbsp;2007)</a>
  <ul class="collapse">
  <li><a href="#descarga-del-árbol-filogenético-y-la-matriz-codificada" id="toc-descarga-del-árbol-filogenético-y-la-matriz-codificada" class="nav-link" data-scroll-target="#descarga-del-árbol-filogenético-y-la-matriz-codificada">Descarga del Árbol Filogenético y la matriz codificada</a></li>
  <li><a href="#carga-de-la-filogenia-y-los-datos" id="toc-carga-de-la-filogenia-y-los-datos" class="nav-link" data-scroll-target="#carga-de-la-filogenia-y-los-datos">Carga de la filogenia y los datos</a></li>
  <li><a href="#definir-el-número-de-estados-en-los-modelos-bisse" id="toc-definir-el-número-de-estados-en-los-modelos-bisse" class="nav-link" data-scroll-target="#definir-el-número-de-estados-en-los-modelos-bisse">Definir el número de estados en los modelos BISSE</a></li>
  <li><a href="#definir-vectores-para-almacenar-los-movimientos-de-mcmc-y-los-monitores-de-resultados." id="toc-definir-vectores-para-almacenar-los-movimientos-de-mcmc-y-los-monitores-de-resultados." class="nav-link" data-scroll-target="#definir-vectores-para-almacenar-los-movimientos-de-mcmc-y-los-monitores-de-resultados.">Definir vectores para almacenar los movimientos de MCMC y los monitores de resultados.</a></li>
  <li><a href="#valores-de-la-log-normal" id="toc-valores-de-la-log-normal" class="nav-link" data-scroll-target="#valores-de-la-log-normal">Valores de la log-normal</a></li>
  <li><a href="#definir-la-matriz-de-tasas-de-transición-entre-los-estados-del-carácter" id="toc-definir-la-matriz-de-tasas-de-transición-entre-los-estados-del-carácter" class="nav-link" data-scroll-target="#definir-la-matriz-de-tasas-de-transición-entre-los-estados-del-carácter">Definir la <strong>matriz de tasas de transición</strong> entre los estados del carácter</a></li>
  <li><a href="#definición-de-las-tasas-de-transición" id="toc-definición-de-las-tasas-de-transición" class="nav-link" data-scroll-target="#definición-de-las-tasas-de-transición">Definición de las tasas de transición</a></li>
  <li><a href="#creación-de-la-matriz-de-tasas-de-transición" id="toc-creación-de-la-matriz-de-tasas-de-transición" class="nav-link" data-scroll-target="#creación-de-la-matriz-de-tasas-de-transición">Creación de la matriz de tasas de transición</a></li>
  <li><a href="#frecuencias-del-estado-en-la-raíz" id="toc-frecuencias-del-estado-en-la-raíz" class="nav-link" data-scroll-target="#frecuencias-del-estado-en-la-raíz">Frecuencias del estado en la raíz</a></li>
  <li><a href="#fijar-la-edad-de-la-raíz" id="toc-fijar-la-edad-de-la-raíz" class="nav-link" data-scroll-target="#fijar-la-edad-de-la-raíz">Fijar la edad de la raíz</a></li>
  <li><a href="#definir-rho-proporción-de-especies-muestreadas" id="toc-definir-rho-proporción-de-especies-muestreadas" class="nav-link" data-scroll-target="#definir-rho-proporción-de-especies-muestreadas">Definir <span class="math inline">\(\rho\)</span> : Proporción de especies muestreadas</a></li>
  <li><a href="#construcción-del-árbol-evolutivo-generado-a-partir-de-un-proceso-de-nacimiento-y-muerte-dependiente-del-carácter" id="toc-construcción-del-árbol-evolutivo-generado-a-partir-de-un-proceso-de-nacimiento-y-muerte-dependiente-del-carácter" class="nav-link" data-scroll-target="#construcción-del-árbol-evolutivo-generado-a-partir-de-un-proceso-de-nacimiento-y-muerte-dependiente-del-carácter">Construcción del árbol evolutivo generado a partir de un proceso de nacimiento y muerte dependiente del carácter</a></li>
  <li><a href="#fijar-clamp-los-datos-observados" id="toc-fijar-clamp-los-datos-observados" class="nav-link" data-scroll-target="#fijar-clamp-los-datos-observados">Fijar (<code>clamp</code>) los datos observados</a></li>
  <li><a href="#creación-del-modelo" id="toc-creación-del-modelo" class="nav-link" data-scroll-target="#creación-del-modelo">Creación del modelo</a></li>
  <li><a href="#configuración-de-los-monitores" id="toc-configuración-de-los-monitores" class="nav-link" data-scroll-target="#configuración-de-los-monitores">Configuración de los monitores</a></li>
  <li><a href="#inicializar-y-ejecutar-el-mcmc" id="toc-inicializar-y-ejecutar-el-mcmc" class="nav-link" data-scroll-target="#inicializar-y-ejecutar-el-mcmc"><strong>Inicializar y Ejecutar el MCMC</strong></a></li>
  <li><a href="#ejecutar-el-mcmc" id="toc-ejecutar-el-mcmc" class="nav-link" data-scroll-target="#ejecutar-el-mcmc">Ejecutar el MCMC</a></li>
  <li><a href="#generar-un-árbol-anotado-con-los-estados-ancestrales-map" id="toc-generar-un-árbol-anotado-con-los-estados-ancestrales-map" class="nav-link" data-scroll-target="#generar-un-árbol-anotado-con-los-estados-ancestrales-map">Generar un árbol anotado con los estados ancestrales (MAP)</a></li>
  <li><a href="#generar-un-mapeo-estocástico-de-caracteres-stochastic-character-mapping" id="toc-generar-un-mapeo-estocástico-de-caracteres-stochastic-character-mapping" class="nav-link" data-scroll-target="#generar-un-mapeo-estocástico-de-caracteres-stochastic-character-mapping">Generar un mapeo estocástico de caracteres (Stochastic Character Mapping)</a></li>
  <li><a href="#visualización-en-r-con-revgadgets" id="toc-visualización-en-r-con-revgadgets" class="nav-link" data-scroll-target="#visualización-en-r-con-revgadgets">Visualización en R con RevGadgets</a></li>
  <li><a href="#graficar-las-tasas-de-transición" id="toc-graficar-las-tasas-de-transición" class="nav-link" data-scroll-target="#graficar-las-tasas-de-transición">Graficar las tasas de transición</a></li>
  <li><a href="#graficar-las-tasas-de-diversificación-neta" id="toc-graficar-las-tasas-de-diversificación-neta" class="nav-link" data-scroll-target="#graficar-las-tasas-de-diversificación-neta">Graficar las tasas de diversificación neta</a></li>
  <li><a href="#graficar-tasas-de-especiación" id="toc-graficar-tasas-de-especiación" class="nav-link" data-scroll-target="#graficar-tasas-de-especiación">Graficar tasas de especiación</a></li>
  <li><a href="#graficar-tasas-de-extinción" id="toc-graficar-tasas-de-extinción" class="nav-link" data-scroll-target="#graficar-tasas-de-extinción">Graficar tasas de extinción</a></li>
  </ul></li>
  <li><a href="#modelo-de-diversificación-con-estados-escondidos-hisse" id="toc-modelo-de-diversificación-con-estados-escondidos-hisse" class="nav-link" data-scroll-target="#modelo-de-diversificación-con-estados-escondidos-hisse">Modelo de diversificación con estados escondidos (HISSE)</a>
  <ul class="collapse">
  <li><a href="#carga-de-la-filogenia-y-los-datos-1" id="toc-carga-de-la-filogenia-y-los-datos-1" class="nav-link" data-scroll-target="#carga-de-la-filogenia-y-los-datos-1">Carga de la filogenia y los datos</a></li>
  <li><a href="#definir-el-número-de-estados-en-los-modelos-hisse-y-paremetros-globales" id="toc-definir-el-número-de-estados-en-los-modelos-hisse-y-paremetros-globales" class="nav-link" data-scroll-target="#definir-el-número-de-estados-en-los-modelos-hisse-y-paremetros-globales">Definir el número de estados en los modelos HISSE y paremetros globales</a></li>
  <li><a href="#definir-vectores-para-almacenar-los-movimientos-de-mcmc-y-los-monitores-de-resultados.-1" id="toc-definir-vectores-para-almacenar-los-movimientos-de-mcmc-y-los-monitores-de-resultados.-1" class="nav-link" data-scroll-target="#definir-vectores-para-almacenar-los-movimientos-de-mcmc-y-los-monitores-de-resultados.-1">Definir vectores para almacenar los movimientos de MCMC y los monitores de resultados.</a></li>
  <li><a href="#extraer-información-del-árbol-filogenético" id="toc-extraer-información-del-árbol-filogenético" class="nav-link" data-scroll-target="#extraer-información-del-árbol-filogenético">Extraer información del árbol filogenético</a></li>
  <li><a href="#definir-la-media-de-las-tasas-de-especiación-y-extinción" id="toc-definir-la-media-de-las-tasas-de-especiación-y-extinción" class="nav-link" data-scroll-target="#definir-la-media-de-las-tasas-de-especiación-y-extinción">Definir la Media de las Tasas de Especiación y Extinción</a></li>
  <li><a href="#especiación-y-extinción-oculta-hidden-speciation-rates" id="toc-especiación-y-extinción-oculta-hidden-speciation-rates" class="nav-link" data-scroll-target="#especiación-y-extinción-oculta-hidden-speciation-rates">Especiación y Extinción Oculta (Hidden Speciation Rates)</a></li>
  <li><a href="#variación-en-las-tasas-ocultas-de-especiación-y-extinción" id="toc-variación-en-las-tasas-ocultas-de-especiación-y-extinción" class="nav-link" data-scroll-target="#variación-en-las-tasas-ocultas-de-especiación-y-extinción">Variación en las Tasas Ocultas de Especiación y Extinción</a></li>
  <li><a href="#movimiento-mcmc-para-optimizar-la-desviación-estándar" id="toc-movimiento-mcmc-para-optimizar-la-desviación-estándar" class="nav-link" data-scroll-target="#movimiento-mcmc-para-optimizar-la-desviación-estándar">Movimiento MCMC para Optimizar la Desviación Estándar</a></li>
  <li><a href="#definir-la-distribución-de-las-tasas-ocultas" id="toc-definir-la-distribución-de-las-tasas-ocultas" class="nav-link" data-scroll-target="#definir-la-distribución-de-las-tasas-ocultas">Definir la Distribución de las Tasas Ocultas</a></li>
  <li><a href="#normalización-de-las-tasas-ocultas" id="toc-normalización-de-las-tasas-ocultas" class="nav-link" data-scroll-target="#normalización-de-las-tasas-ocultas">Normalización de las Tasas Ocultas</a></li>
  <li><a href="#definir-tasas-de-especiación-para-estados-observables" id="toc-definir-tasas-de-especiación-para-estados-observables" class="nav-link" data-scroll-target="#definir-tasas-de-especiación-para-estados-observables">Definir Tasas de Especiación para Estados Observables</a></li>
  <li><a href="#cálculo-de-las-tasas-combinadas" id="toc-cálculo-de-las-tasas-combinadas" class="nav-link" data-scroll-target="#cálculo-de-las-tasas-combinadas">Cálculo de las Tasas Combinadas</a></li>
  <li><a href="#definir-la-matriz-de-transición-entre-estados-observables" id="toc-definir-la-matriz-de-transición-entre-estados-observables" class="nav-link" data-scroll-target="#definir-la-matriz-de-transición-entre-estados-observables">Definir la Matriz de Transición entre Estados Observables</a></li>
  <li><a href="#definir-la-matriz-de-transición-entre-estados-ocultos" id="toc-definir-la-matriz-de-transición-entre-estados-ocultos" class="nav-link" data-scroll-target="#definir-la-matriz-de-transición-entre-estados-ocultos">Definir la Matriz de Transición entre Estados Ocultos</a></li>
  <li><a href="#crear-la-matriz-de-transición-q-combinada" id="toc-crear-la-matriz-de-transición-q-combinada" class="nav-link" data-scroll-target="#crear-la-matriz-de-transición-q-combinada">Crear la Matriz de Transición <code>Q</code> Combinada</a></li>
  <li><a href="#definir-la-distribución-de-los-estados-en-la-raíz" id="toc-definir-la-distribución-de-los-estados-en-la-raíz" class="nav-link" data-scroll-target="#definir-la-distribución-de-los-estados-en-la-raíz">Definir la Distribución de los Estados en la Raíz</a></li>
  <li><a href="#optimización-con-movimientos-mcmc" id="toc-optimización-con-movimientos-mcmc" class="nav-link" data-scroll-target="#optimización-con-movimientos-mcmc">Optimización con Movimientos MCMC</a></li>
  <li><a href="#definir-la-edad-de-la-raíz-del-árbol" id="toc-definir-la-edad-de-la-raíz-del-árbol" class="nav-link" data-scroll-target="#definir-la-edad-de-la-raíz-del-árbol">Definir la Edad de la Raíz del Árbol</a></li>
  <li><a href="#definir-la-probabilidad-de-muestreo-de-especies-rho" id="toc-definir-la-probabilidad-de-muestreo-de-especies-rho" class="nav-link" data-scroll-target="#definir-la-probabilidad-de-muestreo-de-especies-rho">Definir la Probabilidad de Muestreo de Especies (<span class="math inline">\(\rho\)</span>)</a></li>
  <li><a href="#definir-el-árbol-bajo-un-proceso-de-diversificación-dependiente-del-estado" id="toc-definir-el-árbol-bajo-un-proceso-de-diversificación-dependiente-del-estado" class="nav-link" data-scroll-target="#definir-el-árbol-bajo-un-proceso-de-diversificación-dependiente-del-estado">Definir el Árbol Bajo un Proceso de Diversificación Dependiente del Estado</a></li>
  <li><a href="#ajustar-el-modelo-a-la-filogenia-observada" id="toc-ajustar-el-modelo-a-la-filogenia-observada" class="nav-link" data-scroll-target="#ajustar-el-modelo-a-la-filogenia-observada">Ajustar el Modelo a la Filogenia Observada</a></li>
  <li><a href="#ajustar-el-modelo-a-los-datos-de-caracteres" id="toc-ajustar-el-modelo-a-los-datos-de-caracteres" class="nav-link" data-scroll-target="#ajustar-el-modelo-a-los-datos-de-caracteres">Ajustar el Modelo a los Datos de Caracteres</a></li>
  <li><a href="#definir-el-modelo-en-revbayes" id="toc-definir-el-modelo-en-revbayes" class="nav-link" data-scroll-target="#definir-el-modelo-en-revbayes">Definir el Modelo en RevBayes</a></li>
  <li><a href="#configurar-monitores-para-guardar-resultados" id="toc-configurar-monitores-para-guardar-resultados" class="nav-link" data-scroll-target="#configurar-monitores-para-guardar-resultados"><strong>Configurar Monitores para Guardar Resultados</strong></a></li>
  <li><a href="#configurar-el-algoritmo-mcmc" id="toc-configurar-el-algoritmo-mcmc" class="nav-link" data-scroll-target="#configurar-el-algoritmo-mcmc">Configurar el Algoritmo MCMC</a></li>
  <li><a href="#ejecutar-el-mcmc-1" id="toc-ejecutar-el-mcmc-1" class="nav-link" data-scroll-target="#ejecutar-el-mcmc-1">Ejecutar el MCMC</a></li>
  <li><a href="#cargar-la-trazabilidad-de-los-estados-ancestrales" id="toc-cargar-la-trazabilidad-de-los-estados-ancestrales" class="nav-link" data-scroll-target="#cargar-la-trazabilidad-de-los-estados-ancestrales">Cargar la Trazabilidad de los Estados Ancestrales</a></li>
  <li><a href="#construcción-del-árbol-con-estados-ancestrales" id="toc-construcción-del-árbol-con-estados-ancestrales" class="nav-link" data-scroll-target="#construcción-del-árbol-con-estados-ancestrales">Construcción del Árbol con Estados Ancestrales</a></li>
  <li><a href="#definir-parámetros-para-la-resumir-estados-ancestrales" id="toc-definir-parámetros-para-la-resumir-estados-ancestrales" class="nav-link" data-scroll-target="#definir-parámetros-para-la-resumir-estados-ancestrales">Definir Parámetros para la Resumir Estados Ancestrales</a></li>
  <li><a href="#leer-la-historia-del-carácter-inferida-por-mapeo-estocástico" id="toc-leer-la-historia-del-carácter-inferida-por-mapeo-estocástico" class="nav-link" data-scroll-target="#leer-la-historia-del-carácter-inferida-por-mapeo-estocástico">Leer la Historia del Carácter Inferida por Mapeo Estocástico</a></li>
  <li><a href="#crear-el-árbol-de-mapeo-estocástico-de-caracteres" id="toc-crear-el-árbol-de-mapeo-estocástico-de-caracteres" class="nav-link" data-scroll-target="#crear-el-árbol-de-mapeo-estocástico-de-caracteres">Crear el Árbol de Mapeo Estocástico de Caracteres</a></li>
  <li><a href="#visualización-en-r-con-revgadgets-1" id="toc-visualización-en-r-con-revgadgets-1" class="nav-link" data-scroll-target="#visualización-en-r-con-revgadgets-1">Visualización en R con RevGadgets</a></li>
  <li><a href="#graficar-las-tasas-de-diversificación-neta-1" id="toc-graficar-las-tasas-de-diversificación-neta-1" class="nav-link" data-scroll-target="#graficar-las-tasas-de-diversificación-neta-1">Graficar las tasas de diversificación neta</a></li>
  <li><a href="#graficar-tasas-de-especiación-1" id="toc-graficar-tasas-de-especiación-1" class="nav-link" data-scroll-target="#graficar-tasas-de-especiación-1">Graficar tasas de especiación</a></li>
  <li><a href="#graficar-tasas-de-extinción-1" id="toc-graficar-tasas-de-extinción-1" class="nav-link" data-scroll-target="#graficar-tasas-de-extinción-1">Graficar tasas de extinción</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/u1_intro_diversification.html">Unidad 1: Patrones de diversificación</a></li><li class="breadcrumb-item"><a href="../chapters/u1_intro_diversification_4.html"><span class="chapter-title">Introducción a modelos State Speciaction-Extinción (SSE)</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-title">Introducción a modelos State Speciaction-Extinción (SSE)</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="presentación-introducción-a-modelos-state-speciaction-extinción-sse" class="level1">
<h1>Presentación: Introducción a modelos State Speciaction-Extinción (SSE)</h1>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../docs/u1_PatDiv/5_ModSSE.pdf"><img src="../images/u1_PatDiv/u1_PatDiv_5.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="500"></a></p>
</figure>
</div>
<p>Haz clic en la imagen para ver el PDF de la presentación</p>
<p>Analizaremos si las tasas de diversificación están asociadas al tipo de hospedero en los escarabajos meloidos (Meloidae). Las subfamilias Nemognathinae y Meloinae presentan un ciclo de vida complejo, caracterizado por múltiples metamorfosis y estrategias de parasitoidismo. La mayoría de los géneros y tribus dentro de estas subfamilias son parasitoides de abejas, incluyendo especies foréticas y no foréticas. Sin embargo, dos tribus han adoptado una estrategia distinta, alimentándose de huevos de saltamontes. Estas diferencias en las estrategias de vida están asociadas con marcadas variaciones en la riqueza de especies entre clados (<a href="https://onlinelibrary.wiley.com/doi/full/10.1111/mec.16390">López-Estrada et al., 2019</a>).</p>
</section>
<section id="modelo-bisse-binary-state-speciation-and-extinction-madisson-et-al.-2007" class="level1">
<h1>Modelo BiSSE (Binary state speciation and extinction, <a href="https://academic.oup.com/sysbio/article/56/5/701/1694265">Madisson et al.&nbsp;2007</a>)</h1>
<p>BiSSE el modelo de especiación y extinción dependendiente de un caracter binario y es un proceso estocástico que se forma de la composición de dos procesos de nacimiento y muerte. Los dos procesos se conectan a través de dos tasas de cambio conocidas como las tasas de transición. El supuesto más importante del modelo BiSSE es que cada estado tiene su propia tasa de especiación <span class="math inline">\(\lambda\)</span> y su propia tasa de extinción <span class="math inline">\(\mu\)</span> que representan el momento en el cuál un linaje se divide en dos o se extingue. Este es un supuesto muy importante porque la implicación es que la acumulación (o la falta de acumulación) de linajes es el resultado del valor del estado. Pueden encontrar mas información en el material del taller <a href="https://ixchelgzlzr.github.io/filo_bayes_UNAM/">Filo-Bayes</a> - <a href="https://ixchelgzlzr.github.io/filo_bayes_UNAM/docs/discrete/SSEmodels.html">BISSE</a>.</p>
<p><strong>Escarabajos meloidos</strong></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/u1_PatDiv/u1_PatDiv_6.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="550"></p>
</figure>
</div>
<p>Las transiciones entre estados ocurren a tasas <span class="math inline">\(q_{01}\)</span> (de abeja a saltamontes) y <span class="math inline">\(q_{10}\)</span> (de saltamontes a abeja). Cada estado tiene su propia tasa de especiación (<span class="math inline">\(\lambda_0, \lambda_1\)</span>) y extinción (<span class="math inline">\(\mu_0, \mu_1\)</span>).</p>
<p><strong>Matriz de tasas de transición (</strong><span class="math inline">\(Q\)</span>)</p>
<p>La matriz de transición <span class="math inline">\(Q\)</span> define la probabilidad de cambio entre estados en un tiempo infinitesimal:</p>
<p><span class="math display">\[
Q =
\begin{bmatrix}
  -q_{01} &amp; q_{01} \\
  q_{10} &amp; -q_{10}
\end{bmatrix}
\]</span></p>
<p>Donde:</p>
<ul>
<li><p><span class="math inline">\(q_{01}\)</span>: es la tasa de transición de hospedero abeja a hospedero saltamontes.</p></li>
<li><p><span class="math inline">\(q_{10}\)</span>: es la tasa de transición de hospedero saltamontes a hospedero abeja.</p></li>
<li><p>La diagonal contiene los valores negativos de las tasas de salida de cada estado (<span class="math inline">\(-q_{01}\)</span> y <span class="math inline">\(-q_{10}\)</span>), de modo que cada fila suma cero.</p></li>
</ul>
<p><strong>Parámetros en el modelo BiSSE</strong></p>
<p>El modelo incluye seis parámetros fundamentales:</p>
<ul>
<li><p><span class="math inline">\(\lambda_0\)</span>: tasa de especiación en el estado 0 (hospedero abeja)</p></li>
<li><p><span class="math inline">\(\lambda_1\)</span>: tasa de especiación en el estado 1 (hospedero saltamontes)</p></li>
<li><p><span class="math inline">\(\mu_0\)</span>: tasa de extinción en el estado 0</p></li>
<li><p><span class="math inline">\(\mu_1\)</span>: tasa de extinción en el estado 1</p></li>
<li><p><span class="math inline">\(q_{01}\)</span>: tasa de cambio de hospedero abeja a hospedero saltamontes</p></li>
<li><p><span class="math inline">\(q_{10}\)</span>: tasa de cambio de hospedero saltamontes a hospedero abeja</p></li>
</ul>
<section id="descarga-del-árbol-filogenético-y-la-matriz-codificada" class="level2">
<h2 class="anchored" data-anchor-id="descarga-del-árbol-filogenético-y-la-matriz-codificada">Descarga del Árbol Filogenético y la matriz codificada</h2>
<p>📥 Puedes descargar el archivo <strong>.tre</strong> con el árbol en el siguiente enlace:</p>
<p><a href="../docs/u1_PatDiv/ConLyttini.tre" download="">📥 Descargar Árbol Filogenético</a></p>
<p>📥 Puedes descargar el archivo <strong>.nex</strong> con la matriz codificada en el siguiente enlace:</p>
<p><a href="../docs/u1_PatDiv/Traits_conLyttini_01.nex" download="">📥 Descargar Matriz Codificada</a></p>
<p>Guarda los archivos en la carpeta correspondiente y verifica su ubicación antes de continuar.</p>
</section>
<section id="carga-de-la-filogenia-y-los-datos" class="level2">
<h2 class="anchored" data-anchor-id="carga-de-la-filogenia-y-los-datos">Carga de la filogenia y los datos</h2>
<p>Crea un script <code>.Rev</code> y copia el codigo de la siguiente sección:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Leer el arbol</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="fu">readTrees</span>(<span class="st">"../data/ConLyttini.tre"</span>)[<span class="dv">1</span>]</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Leer la matriz de caracteres</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">readCharacterData</span>(<span class="st">"../data/Traits_conLyttini_01.nex"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="definir-el-número-de-estados-en-los-modelos-bisse" class="level2">
<h2 class="anchored" data-anchor-id="definir-el-número-de-estados-en-los-modelos-bisse">Definir el número de estados en los modelos BISSE</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>NUM_STATES <span class="ot">=</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="definir-vectores-para-almacenar-los-movimientos-de-mcmc-y-los-monitores-de-resultados." class="level2">
<h2 class="anchored" data-anchor-id="definir-vectores-para-almacenar-los-movimientos-de-mcmc-y-los-monitores-de-resultados.">Definir vectores para almacenar los movimientos de MCMC y los monitores de resultados.</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>moves    <span class="ot">=</span> <span class="fu">VectorMoves</span>()</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>monitors <span class="ot">=</span> <span class="fu">VectorMonitors</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="valores-de-la-log-normal" class="level2">
<h2 class="anchored" data-anchor-id="valores-de-la-log-normal">Valores de la log-normal</h2>
<p>De acuerdo con Nee et al.&nbsp;(1994) el número esperado de linajes en la corona de un clado con <code>n</code> taxones bajo un proceso de nacimiento y muerte en el tiempo <code>t</code> es:</p>
<p><span class="math inline">\((\lambda - \mu) = \frac{In(n)/2}{t}\)</span></p>
<p>En donde: <code>n</code> = es el número de especies y <code>t</code> = es la edad de la filogenia</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Definimos una a priori log normal</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>rate_mean <span class="ot">&lt;-</span> <span class="fu">ln</span>(<span class="fu">ln</span>(<span class="fl">3000.0</span><span class="sc">/</span><span class="fl">2.0</span>) <span class="sc">/</span> <span class="fu">T.rootAge</span>())</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Con una varianza que es amplia</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>rate_sd <span class="ot">&lt;-</span> <span class="fl">0.587405</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NUM_STATES) {</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># lognormales de las especiaciones</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  log_speciation[i] <span class="sc">~</span> <span class="fu">dnNormal</span>(<span class="at">mean=</span>rate_mean, <span class="at">sd=</span>rate_sd) </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  speciation[i] <span class="sc">:</span><span class="er">=</span> <span class="fu">exp</span>(log_speciation[i])</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">moves.append</span>(<span class="fu">mvSlide</span>(log_speciation[i], <span class="at">delta=</span><span class="fl">0.20</span>, <span class="at">tune=</span>true, <span class="at">weight=</span><span class="fl">3.0</span>))</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># lognormales de las extinciones</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  log_extinction[i] <span class="sc">~</span> <span class="fu">dnNormal</span>(<span class="at">mean=</span>rate_mean, <span class="at">sd=</span>rate_sd)  </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  extinction[i] <span class="sc">:</span><span class="er">=</span> <span class="fu">exp</span>(log_extinction[i])</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">moves.append</span>(<span class="fu">mvSlide</span>(log_extinction[i], <span class="at">delta=</span><span class="fl">0.20</span>, <span class="at">tune=</span>true, <span class="at">weight=</span><span class="fl">3.0</span>))</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="definir-la-matriz-de-tasas-de-transición-entre-los-estados-del-carácter" class="level2">
<h2 class="anchored" data-anchor-id="definir-la-matriz-de-tasas-de-transición-entre-los-estados-del-carácter">Definir la <strong>matriz de tasas de transición</strong> entre los estados del carácter</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcula la suma de todas las longitudes de las ramas del árbol filogenético</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Dividido por 10: Esto asume que en promedio ocurren 10 cambios de estado a lo largo del árbol</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>rate_pr <span class="sc">:</span><span class="er">=</span> <span class="fu">T.treeLength</span>() <span class="sc">/</span> <span class="dv">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="definición-de-las-tasas-de-transición" class="level2">
<h2 class="anchored" data-anchor-id="definición-de-las-tasas-de-transición">Definición de las tasas de transición</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tasa de transición de estado 1 → estado 2 </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>rate_12 <span class="sc">~</span> <span class="fu">dnExp</span>(rate_pr)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Tasa de transición de estado 2 → estado 1 </span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>rate_21 <span class="sc">~</span> <span class="fu">dnExp</span>(rate_pr)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Definición de movimientos </span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">moves.append</span>(<span class="fu">mvScale</span>(rate_12, <span class="at">weight=</span><span class="dv">2</span>))</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">moves.append</span>(<span class="fu">mvScale</span>(rate_21, <span class="at">weight=</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>¿Por qué usar una exponencial?</strong></p>
<ul>
<li><p>La distribución exponencial es adecuada para modelar <strong>tasas de transición</strong> porque impone la condición de que siempre sean <strong>positivas</strong>.</p></li>
<li><p>También asigna <strong>mayor probabilidad a valores pequeños</strong>, lo que significa que los cambios de estado no ocurren demasiado rápido.</p></li>
</ul>
</section>
<section id="creación-de-la-matriz-de-tasas-de-transición" class="level2">
<h2 class="anchored" data-anchor-id="creación-de-la-matriz-de-tasas-de-transición">Creación de la matriz de tasas de transición</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>rate_matrix <span class="sc">:</span><span class="er">=</span> <span class="fu">fnFreeBinary</span>([rate_12, rate_21 ], <span class="at">rescaled=</span>false)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="frecuencias-del-estado-en-la-raíz" class="level2">
<h2 class="anchored" data-anchor-id="frecuencias-del-estado-en-la-raíz">Frecuencias del estado en la raíz</h2>
<div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>rate_category_prior <span class="sc">~</span> <span class="fu">dnDirichlet</span>(<span class="fu">rep</span>(<span class="dv">1</span>,NUM_STATES))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">moves.append</span>(<span class="fu">mvDirichletSimplex</span>(rate_category_prior, <span class="at">tune=</span>true, <span class="at">weight=</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="fijar-la-edad-de-la-raíz" class="level2">
<h2 class="anchored" data-anchor-id="fijar-la-edad-de-la-raíz">Fijar la edad de la raíz</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>root <span class="ot">&lt;-</span> <span class="fu">T.rootAge</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="definir-rho-proporción-de-especies-muestreadas" class="level2">
<h2 class="anchored" data-anchor-id="definir-rho-proporción-de-especies-muestreadas">Definir <span class="math inline">\(\rho\)</span> : Proporción de especies muestreadas</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="fu">T.ntips</span>()<span class="sc">/</span><span class="dv">3000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="construcción-del-árbol-evolutivo-generado-a-partir-de-un-proceso-de-nacimiento-y-muerte-dependiente-del-carácter" class="level2">
<h2 class="anchored" data-anchor-id="construcción-del-árbol-evolutivo-generado-a-partir-de-un-proceso-de-nacimiento-y-muerte-dependiente-del-carácter">Construcción del árbol evolutivo generado a partir de un proceso de nacimiento y muerte dependiente del carácter</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>timetree <span class="sc">~</span> <span class="fu">dnCDBDP</span>(<span class="at">rootAge =</span> root, <span class="at">speciationRates =</span> speciation, <span class="at">extinctionRates =</span> extinction, <span class="at">Q =</span> rate_matrix, <span class="at">pi =</span> rate_category_prior, <span class="at">delta =</span> <span class="fl">1.0</span>, <span class="at">rho =</span> rho, <span class="at">condition =</span> <span class="st">"time"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>🔹 <strong>Parámetros del proceso de nacimiento y muerte (<code>dnCDBDP</code>)</strong>:</p>
<ul>
<li><p><strong><code>rootAge = root</code></strong> → Se fija la edad de la raíz usando <code>root = T.rootAge()</code>.</p></li>
<li><p><strong><code>speciationRates = speciation</code></strong> → Se usa la tasa de especiación (<code>λ</code>).</p></li>
<li><p><strong><code>extinctionRates = extinction</code></strong> → Se usa la tasa de extinción (<code>μ</code>).</p></li>
<li><p><strong><code>Q = rate_matrix</code></strong> → Usa la <strong>matriz de tasas de transición</strong> de caracteres (<code>rate_12</code>, <code>rate_21</code>).</p></li>
<li><p><strong><code>pi = rate_category_prior</code></strong> → Usa la distribución <strong>a priori</strong> de los estados en la raíz.</p></li>
<li><p><strong><code>delta = 1.0</code></strong> → Parámetro de ajuste para la distribución de tiempos de especiación/extinción.</p></li>
<li><p><strong><code>rho = rho</code></strong> → Probabilidad de muestreo de especies (<code>rho = T.ntips()/3000</code>).</p></li>
<li><p><strong><code>condition = "time"</code></strong> → Condiciona el proceso a un tiempo de raíz fijo.</p></li>
</ul>
</section>
<section id="fijar-clamp-los-datos-observados" class="level2">
<h2 class="anchored" data-anchor-id="fijar-clamp-los-datos-observados">Fijar (<code>clamp</code>) los datos observados</h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">timetree.clamp</span>(T)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">timetree.clampCharData</span>(datos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="creación-del-modelo" class="level2">
<h2 class="anchored" data-anchor-id="creación-del-modelo">Creación del modelo</h2>
<div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">### workspace model wrapper </span><span class="al">###</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>mymodel <span class="ot">=</span> <span class="fu">model</span>(rate_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="configuración-de-los-monitores" class="level2">
<h2 class="anchored" data-anchor-id="configuración-de-los-monitores">Configuración de los monitores</h2>
<p>Los <strong>monitores</strong> guardan los resultados en archivos o los imprimen en pantalla.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">monitors.append</span>(<span class="fu">mnModel</span>(<span class="at">filename=</span><span class="st">"../out/Bisse/mitos_BiSSE_clyttini.log"</span>, <span class="at">printgen=</span><span class="dv">1</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">monitors.append</span>(<span class="fu">mnJointConditionalAncestralState</span>(<span class="at">tree=</span>timetree, <span class="at">cdbdp=</span>timetree, <span class="at">type=</span><span class="st">"Standard"</span>, <span class="at">printgen=</span><span class="dv">1</span>, <span class="at">withTips=</span>true, <span class="at">withStartStates=</span>false, <span class="at">filename=</span><span class="st">"../out/Bisse/anc_states_MITOS_BiSSE_clyttini.log"</span>))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">monitors.append</span>(<span class="fu">mnStochasticCharacterMap</span>(<span class="at">cdbdp=</span>timetree, <span class="at">printgen=</span><span class="dv">10</span>, <span class="at">filename=</span><span class="st">"../out/Bisse/SCHM_BiSSE_clyttini.log"</span>))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">monitors.append</span>(<span class="fu">mnScreen</span>(<span class="at">printgen=</span><span class="dv">10</span>, rate_12, rate_21, speciation, extinction))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="inicializar-y-ejecutar-el-mcmc" class="level2">
<h2 class="anchored" data-anchor-id="inicializar-y-ejecutar-el-mcmc"><strong>Inicializar y Ejecutar el MCMC</strong></h2>
<p>Con el modelo y los monitores listos, creamos el <strong>objeto MCMC</strong> e iniciamos la simulación.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>mymcmc <span class="ot">=</span> <span class="fu">mcmc</span>(mymodel, monitors, moves, <span class="at">nruns=</span><span class="dv">1</span>, <span class="at">moveschedule=</span><span class="st">"random"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><p><code>mymodel</code>: hace referencia al modelo que estás analizando.</p></li>
<li><p><code>monitors</code>: son las variables que se registrarán en el archivo de salida.</p></li>
<li><p><code>moves</code>: operadores MCMC que proponen cambios en los parámetros del modelo.</p></li>
<li><p><code>nruns=1</code>: solo una cadena MCMC (puedes usar más si deseas una inferencia más robusta).</p></li>
<li><p><code>moveschedule="random"</code>: ejecuta los operadores en orden aleatorio para evitar sesgos en la exploración del espacio de parámetros.</p></li>
</ul>
</section>
<section id="ejecutar-el-mcmc" class="level2">
<h2 class="anchored" data-anchor-id="ejecutar-el-mcmc">Ejecutar el MCMC</h2>
<div class="sourceCode" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mymcmc.run</span>(<span class="at">generations=</span><span class="dv">400</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="generar-un-árbol-anotado-con-los-estados-ancestrales-map" class="level2">
<h2 class="anchored" data-anchor-id="generar-un-árbol-anotado-con-los-estados-ancestrales-map">Generar un árbol anotado con los estados ancestrales (MAP)</h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>anc_states <span class="ot">=</span> <span class="fu">readAncestralStateTrace</span>(<span class="st">"../out/Bisse/anc_states_MITOS_BiSSE_clyttini.log"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>anc_tree <span class="ot">=</span> <span class="fu">ancestralStateTree</span>(<span class="at">tree=</span>T, <span class="at">ancestral_state_trace_vector=</span>anc_states, <span class="at">include_start_states=</span>false, <span class="at">file=</span><span class="st">"../out/Bisse/mitos_bisse_anc_states_results.tree"</span>, <span class="at">burnin=</span><span class="fl">0.2</span>, <span class="at">summary_statistic=</span><span class="st">"MAP"</span>, <span class="at">site=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="generar-un-mapeo-estocástico-de-caracteres-stochastic-character-mapping" class="level2">
<h2 class="anchored" data-anchor-id="generar-un-mapeo-estocástico-de-caracteres-stochastic-character-mapping">Generar un mapeo estocástico de caracteres (Stochastic Character Mapping)</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>anc_state_trace <span class="ot">=</span> <span class="fu">readAncestralStateTrace</span>(<span class="st">"../out/Bisse/SCHM_BiSSE_clyttini.log"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">characterMapTree</span>(<span class="at">tree=</span>T, <span class="at">ancestral_state_trace_vector=</span>anc_state_trace, <span class="at">character_file=</span><span class="st">"../out/Bisse/mitos_bisse_stoch_map_character.tree"</span>, <span class="at">posterior_file=</span><span class="st">"../out/Bisse/mitos_bisse_stoch_map_posterior.tree"</span>, <span class="at">burnin=</span><span class="fl">0.2</span>, <span class="at">reconstruction=</span><span class="st">"marginal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="visualización-en-r-con-revgadgets" class="level2">
<h2 class="anchored" data-anchor-id="visualización-en-r-con-revgadgets">Visualización en R con RevGadgets</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RevGadgets)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggtree)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar el archivo de estados ancestrales</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>bisse_file <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"../docs/u1_PatDiv/output/bisse/mitos_bisse_anc_states_results.tree"</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>p_anc <span class="ot">&lt;-</span> <span class="fu">processAncStates</span>(bisse_file)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir paleta de colores personalizada</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>traitcols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#F29494"</span>, <span class="st">"#5FD9D9"</span>)  </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Generar el gráfico con estados </span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">plotAncStatesMAP</span>(p_anc,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">tree_layout =</span> <span class="st">"rect"</span>,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">tip_labels_size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Aplicar la paleta de colores</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_color_manual</span>(<span class="at">values =</span> traitcols) <span class="sc">+</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> traitcols) <span class="sc">+</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Modificar leyenda y otros elementos de ggplot2</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.85</span>),</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">'cm'</span>), <span class="co"># Tamaño de la clave de la leyenda</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>), <span class="co"># Tamaño del título de la leyenda</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>              <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">4</span>))  <span class="co"># Tamaño del texto de la leyenda</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar el gráfico</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="u1_intro_diversification_4_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generar el gráfico con ramas coloreadas por estado ancestral</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>plot_2 <span class="ot">&lt;-</span> <span class="fu">ggtree</span>(p_anc, <span class="at">layout =</span> <span class="st">"rectangular"</span>, <span class="fu">aes</span>(<span class="at">color =</span> anc_state_1)) <span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estado"</span>, <span class="at">values =</span> traitcols) <span class="sc">+</span>  </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"BISSE"</span>) <span class="sc">+</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.85</span>),</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">'cm'</span>), <span class="co"># Tamaño de la clave de la leyenda</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>), <span class="co"># Tamaño del título de la leyenda</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">4</span>))  <span class="co"># Tamaño del texto de la leyenda</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar el gráfico</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>plot_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="u1_intro_diversification_4_files/figure-html/unnamed-chunk-1-2.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="graficar-las-tasas-de-transición" class="level2">
<h2 class="anchored" data-anchor-id="graficar-las-tasas-de-transición">Graficar las tasas de transición</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Leer el archivo de salida de RevBayes</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>bisse <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"../docs/u1_PatDiv/output/bisse/mitos_BiSSE_clyttini.log"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir colores para los estados 0 y 1</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>traitcols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#F29494"</span>, <span class="st">"#5FD9D9"</span>)  </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear un dataframe con solo las tasas de transición</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>transition_rates <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">dens =</span> <span class="fu">c</span>(bisse<span class="sc">$</span>rate_12, bisse<span class="sc">$</span>rate_21), </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">rate =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1"</span>), <span class="at">each =</span> <span class="fu">length</span>(bisse<span class="sc">$</span>rate_12))</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear un gráfico de violín para las tasas de transición</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>violin_transitions <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(transition_rates, <span class="fu">aes</span>(<span class="at">x =</span> rate, <span class="at">y =</span> dens, <span class="at">fill =</span> rate)) <span class="sc">+</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">trim =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Tasas de Transición"</span>, <span class="at">x =</span> <span class="st">"Estado"</span>, <span class="at">y =</span> <span class="st">"Tasa"</span>) <span class="sc">+</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Estado"</span>, <span class="at">values =</span> traitcols) <span class="sc">+</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar la gráfica</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>violin_transitions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="u1_intro_diversification_4_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="graficar-las-tasas-de-diversificación-neta" class="level2">
<h2 class="anchored" data-anchor-id="graficar-las-tasas-de-diversificación-neta">Graficar las tasas de diversificación neta</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular la tasa de diversificación neta: especiación - extinción</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>netdiversification_rates <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dens =</span> <span class="fu">c</span>(bisse<span class="sc">$</span>speciation.<span class="fl">1.</span> <span class="sc">-</span> bisse<span class="sc">$</span>extinction.<span class="fl">1.</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>           bisse<span class="sc">$</span>speciation.<span class="fl">2.</span> <span class="sc">-</span> bisse<span class="sc">$</span>extinction.<span class="fl">2.</span>),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">rate =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1"</span>), <span class="at">each =</span> <span class="fu">length</span>(bisse<span class="sc">$</span>speciation.<span class="fl">1.</span>))</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir la variable de estado en factor</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>netdiversification_rates<span class="sc">$</span>rate <span class="ot">&lt;-</span> <span class="fu">factor</span>(netdiversification_rates<span class="sc">$</span>rate, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1"</span>))</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear el gráfico de violín para tasas de diversificación neta</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>violin_diversification <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(netdiversification_rates, <span class="fu">aes</span>(<span class="at">x =</span> rate, <span class="at">y =</span> dens, <span class="at">fill =</span> rate)) <span class="sc">+</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">trim =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Tasas de Diversificación Neta"</span>, <span class="at">x =</span> <span class="st">"Estado"</span>, <span class="at">y =</span> <span class="st">"Tasa"</span>) <span class="sc">+</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Estado"</span>, <span class="at">values =</span> traitcols) <span class="sc">+</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar la gráfica</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>violin_diversification</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="u1_intro_diversification_4_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="graficar-tasas-de-especiación" class="level2">
<h2 class="anchored" data-anchor-id="graficar-tasas-de-especiación">Graficar tasas de especiación</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear un dataframe con tasas de especiación para cada estado</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>speciation_rates <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dens =</span> <span class="fu">c</span>(bisse<span class="sc">$</span>speciation.<span class="fl">1.</span>,  bisse<span class="sc">$</span>speciation.<span class="fl">2.</span>), </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">rate =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1"</span>), <span class="at">each =</span> <span class="fu">length</span>(bisse<span class="sc">$</span>speciation.<span class="fl">1.</span>))</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear gráfico de violín para las tasas de especiación</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>violin_speciation <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(speciation_rates, <span class="fu">aes</span>(<span class="at">x =</span> rate, <span class="at">y =</span> dens, <span class="at">fill =</span> rate)) <span class="sc">+</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">trim =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Tasas de Especiación"</span>, <span class="at">x =</span> <span class="st">"Estado"</span>, <span class="at">y =</span> <span class="st">"Tasa de Especiación"</span>) <span class="sc">+</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Estado"</span>, <span class="at">values =</span> traitcols) <span class="sc">+</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar la gráfica</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>violin_speciation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="u1_intro_diversification_4_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="graficar-tasas-de-extinción" class="level2">
<h2 class="anchored" data-anchor-id="graficar-tasas-de-extinción">Graficar tasas de extinción</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear un dataframe con tasas de extinción para cada estado</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>extinction_rates <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dens =</span> <span class="fu">c</span>(bisse<span class="sc">$</span>extinction.<span class="fl">1.</span>, bisse<span class="sc">$</span>extinction.<span class="fl">2.</span>), </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">rate =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1"</span>), <span class="at">each =</span> <span class="fu">length</span>(bisse<span class="sc">$</span>extinction.<span class="fl">1.</span>))</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear gráfico de violín para tasas de extinción</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>violin_extinction <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(extinction_rates, <span class="fu">aes</span>(<span class="at">x =</span> rate, <span class="at">y =</span> dens, <span class="at">fill =</span> rate)) <span class="sc">+</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">trim =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Tasas de Extinción"</span>, <span class="at">x =</span> <span class="st">"Estado"</span>, <span class="at">y =</span> <span class="st">"Tasa de Extinción"</span>) <span class="sc">+</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Estado"</span>, <span class="at">values =</span> traitcols) <span class="sc">+</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar la gráfica</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>violin_extinction</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="u1_intro_diversification_4_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="modelo-de-diversificación-con-estados-escondidos-hisse" class="level1">
<h1>Modelo de diversificación con estados escondidos (HISSE)</h1>
<p>Uno de los descubrimientos más importantes en el campo de los modelos de diversificación dependientes de estado (SSE) fue hecho por <a href="https://pubmed.ncbi.nlm.nih.gov/25601943/">Rabosky y Goldberg (2015)</a>. Estos autores encontraron, que BiSSE generaba un elevado error tipo I. En estadística este error se refiere a rechazar la hipótesis nula cuando en general la hipótesis es verdadera.</p>
<p><strong>Modelo HiSSE con dos estados y asociando a dos estados escondidos</strong></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/u1_PatDiv/u1_PatDiv_7.jpeg" class="img-fluid quarto-figure quarto-figure-center figure-img" width="500"></p>
</figure>
</div>
<ul>
<li><p>Si tenemos dos estados 0 y 1, estos se convierten ahora en cuatro estados 0A, 0B, 1A, 1B.</p></li>
<li><p>Para cada uno de los estados definimos una nueva tasa de especiación <span class="math inline">\(\lambda_{0A}\)</span>, <span class="math inline">\(\lambda_{0B}\)</span>, <span class="math inline">\(\lambda_{1A}\)</span> y <span class="math inline">\(\lambda_{1B}\)</span>.</p></li>
<li><p>Para cada uno de los estados definimos una nueva tasa de extinción <span class="math inline">\(\mu_{0A}\)</span>, <span class="math inline">\(\mu_{0B}\)</span>, <span class="math inline">\(\mu_{1A}\)</span> y <span class="math inline">\(\mu_{1B}\)</span>.</p></li>
</ul>
<p><strong>Matriz de tasas de transición <code>Q</code></strong></p>
<p><span class="math display">\[
Q =
\begin{bmatrix}
  - &amp; q_{0A \to 0B} &amp; q_{0A \to 1A} &amp; 0 \\
  q_{0B \to 0A} &amp; - &amp; 0 &amp; q_{0B \to 1B} \\
  q_{1A \to 0A} &amp; 0 &amp; - &amp; q_{1A \to 1B} \\
  0 &amp; q_{1B \to 0B} &amp; q_{1B \to 1A} &amp; -
\end{bmatrix}
\]</span></p>
<p>La matriz <code>Q</code> muestra cómo los estados observables y ocultos interactúan, ayudando a inferir <strong>cómo los cambios de carácter afectan la especiación y extinción</strong>.</p>
<section id="carga-de-la-filogenia-y-los-datos-1" class="level2">
<h2 class="anchored" data-anchor-id="carga-de-la-filogenia-y-los-datos-1">Carga de la filogenia y los datos</h2>
<p>Crea un script <code>.Rev</code> y copia el codigo de la siguiente sección:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Leer el arbol</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="fu">readTrees</span>(<span class="st">"../data/ConLyttini.tre"</span>)[<span class="dv">1</span>]</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Leer la matriz de caracteres</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">readCharacterData</span>(<span class="st">"../data/Traits_conLyttini_01.nex"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="definir-el-número-de-estados-en-los-modelos-hisse-y-paremetros-globales" class="level2">
<h2 class="anchored" data-anchor-id="definir-el-número-de-estados-en-los-modelos-hisse-y-paremetros-globales">Definir el número de estados en los modelos HISSE y paremetros globales</h2>
<div class="sourceCode" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>NUM_TOTAL_SPECIES     <span class="ot">=</span> <span class="fl">3000.0</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>NUM_STATES            <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>NUM_HIDDEN            <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>NUM_RATES             <span class="ot">=</span> NUM_STATES <span class="sc">*</span> NUM_HIDDEN</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>H                     <span class="ot">=</span> <span class="fl">0.587405</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Expansión de los Datos para Incluir Estados Ocultos </span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>data_exp <span class="ot">&lt;-</span> <span class="fu">datos.expandCharacters</span>(NUM_HIDDEN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="definir-vectores-para-almacenar-los-movimientos-de-mcmc-y-los-monitores-de-resultados.-1" class="level2">
<h2 class="anchored" data-anchor-id="definir-vectores-para-almacenar-los-movimientos-de-mcmc-y-los-monitores-de-resultados.-1">Definir vectores para almacenar los movimientos de MCMC y los monitores de resultados.</h2>
<div class="sourceCode" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>moves    <span class="ot">=</span> <span class="fu">VectorMoves</span>()</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>monitors <span class="ot">=</span> <span class="fu">VectorMonitors</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="extraer-información-del-árbol-filogenético" class="level2">
<h2 class="anchored" data-anchor-id="extraer-información-del-árbol-filogenético">Extraer información del árbol filogenético</h2>
<div class="sourceCode" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>taxa <span class="ot">&lt;-</span> <span class="fu">T.taxa</span>()</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>tree_length <span class="ot">&lt;-</span> <span class="fu">T.treeLength</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="definir-la-media-de-las-tasas-de-especiación-y-extinción" class="level2">
<h2 class="anchored" data-anchor-id="definir-la-media-de-las-tasas-de-especiación-y-extinción">Definir la Media de las Tasas de Especiación y Extinción</h2>
<div class="sourceCode" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>rate_mean <span class="ot">&lt;-</span> (NUM_TOTAL_SPECIES <span class="sc">-</span> <span class="dv">2</span>) <span class="sc">/</span> tree_length</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>✅ Calcula la <strong>media esperada de las tasas de especiación y extinción</strong> basada en el número total de especies y la longitud del árbol.</p>
</section>
<section id="especiación-y-extinción-oculta-hidden-speciation-rates" class="level2">
<h2 class="anchored" data-anchor-id="especiación-y-extinción-oculta-hidden-speciation-rates">Especiación y Extinción Oculta (Hidden Speciation Rates)</h2>
<div class="sourceCode" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>ln_speciation_hidden_mean <span class="ot">&lt;-</span> <span class="fu">ln</span>(<span class="fl">1.0</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>ln_extinction_hidden_mean <span class="ot">&lt;-</span> <span class="fu">ln</span>(<span class="fl">1.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>✅ Define la media logarítmica de las tasas ocultas de especiación como 1.0 en una escala relativa. ✔️ Esto significa que los valores generados serán proporcionales, y no absolutos.</p>
</section>
<section id="variación-en-las-tasas-ocultas-de-especiación-y-extinción" class="level2">
<h2 class="anchored" data-anchor-id="variación-en-las-tasas-ocultas-de-especiación-y-extinción">Variación en las Tasas Ocultas de Especiación y Extinción</h2>
<div class="sourceCode" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>speciation_hidden_sd <span class="sc">~</span> <span class="fu">dnExponential</span>(<span class="fl">1.0</span> <span class="sc">/</span> H)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>extinction_hidden_sd <span class="sc">~</span> <span class="fu">dnExponential</span>(<span class="fl">1.0</span> <span class="sc">/</span> H)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="movimiento-mcmc-para-optimizar-la-desviación-estándar" class="level2">
<h2 class="anchored" data-anchor-id="movimiento-mcmc-para-optimizar-la-desviación-estándar">Movimiento MCMC para Optimizar la Desviación Estándar</h2>
<div class="sourceCode" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moves.append</span>(<span class="fu">mvScale</span>(speciation_hidden_sd, <span class="at">lambda=</span><span class="dv">1</span>, <span class="at">tune=</span>true, <span class="at">weight=</span><span class="fl">2.0</span>))</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">moves.append</span>(<span class="fu">mvScale</span>(extinction_hidden_sd, <span class="at">lambda=</span><span class="dv">1</span>, <span class="at">tune=</span>true, <span class="at">weight=</span><span class="fl">2.0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="definir-la-distribución-de-las-tasas-ocultas" class="level2">
<h2 class="anchored" data-anchor-id="definir-la-distribución-de-las-tasas-ocultas">Definir la Distribución de las Tasas Ocultas</h2>
<div class="sourceCode" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>speciation_hidden_unormalized <span class="sc">:</span><span class="er">=</span> <span class="fu">fnDiscretizeDistribution</span>(<span class="fu">dnLognormal</span>(ln_speciation_hidden_mean, speciation_hidden_sd), NUM_HIDDEN)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>extinction_hidden_unormalized <span class="sc">:</span><span class="er">=</span> <span class="fu">fnDiscretizeDistribution</span>(<span class="fu">dnLognormal</span>(ln_extinction_hidden_mean, extinction_hidden_sd), NUM_HIDDEN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>✅ Se genera un conjunto de tasas ocultas de especiación a partir de una distribución lognormal.</p>
</section>
<section id="normalización-de-las-tasas-ocultas" class="level2">
<h2 class="anchored" data-anchor-id="normalización-de-las-tasas-ocultas">Normalización de las Tasas Ocultas</h2>
<div class="sourceCode" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>speciation_hidden <span class="sc">:</span><span class="er">=</span> speciation_hidden_unormalized <span class="sc">/</span> <span class="fu">mean</span>(speciation_hidden_unormalized)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>extinction_hidden <span class="sc">:</span><span class="er">=</span> extinction_hidden_unormalized <span class="sc">/</span> <span class="fu">mean</span>(extinction_hidden_unormalized)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>✅ Se normalizan las tasas ocultas dividiéndolas por su media, para que el promedio sea 1.0. ✔️ Esto garantiza que los valores sean relativos y comparables entre estados.</p>
</section>
<section id="definir-tasas-de-especiación-para-estados-observables" class="level2">
<h2 class="anchored" data-anchor-id="definir-tasas-de-especiación-para-estados-observables">Definir Tasas de Especiación para Estados Observables</h2>
<div class="sourceCode" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NUM_STATES) {</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    speciation_observed[i] <span class="sc">~</span> <span class="fu">dnLoguniform</span>( <span class="fl">1E-6</span>, <span class="fl">1E2</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    speciation_observed[i]<span class="fu">.setValue</span>( (NUM_TOTAL_SPECIES<span class="dv">-2</span>) <span class="sc">/</span> tree_length )</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">moves.append</span>( <span class="fu">mvScale</span>(speciation_observed[i], <span class="at">lambda=</span><span class="fl">1.0</span>, <span class="at">tune=</span>true, <span class="at">weight=</span><span class="fl">3.0</span>) )</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>        <span class="do">### Create a loguniform distributed variable for the extinction rate</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    extinction_observed[i] <span class="sc">~</span> <span class="fu">dnLoguniform</span>( <span class="fl">1E-6</span>, <span class="fl">1E2</span>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    extinction_observed[i]<span class="fu">.setValue</span>( speciation_observed[i] <span class="sc">/</span> <span class="fl">10.0</span> )</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">moves.append</span>( <span class="fu">mvScale</span>(extinction_observed[i], <span class="at">lambda=</span><span class="fl">1.0</span>, <span class="at">tune=</span>true, <span class="at">weight=</span><span class="fl">3.0</span>) )</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="cálculo-de-las-tasas-combinadas" class="level2">
<h2 class="anchored" data-anchor-id="cálculo-de-las-tasas-combinadas">Cálculo de las Tasas Combinadas</h2>
<div class="sourceCode" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NUM_HIDDEN) {</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NUM_STATES) {</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>        index <span class="ot">=</span> i<span class="sc">+</span>(j<span class="sc">*</span>NUM_STATES)<span class="sc">-</span>NUM_STATES</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>        speciation[index] <span class="sc">:</span><span class="er">=</span> speciation_observed[i] <span class="sc">*</span> speciation_hidden[j]</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>        extinction[index] <span class="sc">:</span><span class="er">=</span> extinction_observed[i] <span class="sc">*</span> extinction_hidden[j]</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="definir-la-matriz-de-transición-entre-estados-observables" class="level2">
<h2 class="anchored" data-anchor-id="definir-la-matriz-de-transición-entre-estados-observables">Definir la Matriz de Transición entre Estados Observables</h2>
<div class="sourceCode" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>rate_pr <span class="sc">:</span><span class="er">=</span> <span class="fu">T.treeLength</span>() <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(NUM_STATES<span class="sc">*</span>(NUM_STATES<span class="dv">-1</span>)) ) {</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    transition_rates[i] <span class="sc">~</span> <span class="fu">dnExp</span>(rate_pr)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">moves.append</span>( <span class="fu">mvScale</span>(transition_rates[i], <span class="at">lambda=</span><span class="fl">0.50</span>, <span class="at">tune=</span>true, <span class="at">weight=</span><span class="fl">3.0</span>) )</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="definir-la-matriz-de-transición-entre-estados-ocultos" class="level2">
<h2 class="anchored" data-anchor-id="definir-la-matriz-de-transición-entre-estados-ocultos">Definir la Matriz de Transición entre Estados Ocultos</h2>
<div class="sourceCode" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>hidden_rate <span class="sc">~</span> <span class="fu">dnExponential</span>(rate_pr)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">moves.append</span>( <span class="fu">mvScale</span>(hidden_rate, <span class="at">lambda=</span><span class="fl">0.5</span>, <span class="at">tune=</span>true, <span class="at">weight=</span><span class="dv">5</span>) )</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(NUM_HIDDEN <span class="sc">*</span> (NUM_HIDDEN <span class="sc">-</span> <span class="dv">1</span>))) {</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    R[i] <span class="sc">:</span><span class="er">=</span> hidden_rate</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="crear-la-matriz-de-transición-q-combinada" class="level2">
<h2 class="anchored" data-anchor-id="crear-la-matriz-de-transición-q-combinada">Crear la Matriz de Transición <code>Q</code> Combinada</h2>
<div class="sourceCode" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>rate_matrix <span class="sc">:</span><span class="er">=</span> <span class="fu">fnHiddenStateRateMatrix</span>(transition_rates, R, <span class="at">rescaled=</span>false)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="definir-la-distribución-de-los-estados-en-la-raíz" class="level2">
<h2 class="anchored" data-anchor-id="definir-la-distribución-de-los-estados-en-la-raíz">Definir la Distribución de los Estados en la Raíz</h2>
<div class="sourceCode" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>rate_category_prior <span class="sc">~</span> <span class="fu">dnDirichlet</span>( <span class="fu">rep</span>(<span class="dv">1</span>,NUM_RATES) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="optimización-con-movimientos-mcmc" class="level2">
<h2 class="anchored" data-anchor-id="optimización-con-movimientos-mcmc">Optimización con Movimientos MCMC</h2>
<div class="sourceCode" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moves.append</span>( <span class="fu">mvBetaSimplex</span>(rate_category_prior, <span class="at">tune=</span>true, <span class="at">weight=</span><span class="dv">2</span>) )</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">moves.append</span>( <span class="fu">mvDirichletSimplex</span>(rate_category_prior, <span class="at">tune=</span>true, <span class="at">weight=</span><span class="dv">2</span>) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="definir-la-edad-de-la-raíz-del-árbol" class="level2">
<h2 class="anchored" data-anchor-id="definir-la-edad-de-la-raíz-del-árbol">Definir la Edad de la Raíz del Árbol</h2>
<div class="sourceCode" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>root <span class="ot">&lt;-</span> <span class="fu">T.rootAge</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="definir-la-probabilidad-de-muestreo-de-especies-rho" class="level2">
<h2 class="anchored" data-anchor-id="definir-la-probabilidad-de-muestreo-de-especies-rho">Definir la Probabilidad de Muestreo de Especies (<span class="math inline">\(\rho\)</span>)</h2>
<div class="sourceCode" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="fu">T.ntips</span>()<span class="sc">/</span><span class="fl">3000.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="definir-el-árbol-bajo-un-proceso-de-diversificación-dependiente-del-estado" class="level2">
<h2 class="anchored" data-anchor-id="definir-el-árbol-bajo-un-proceso-de-diversificación-dependiente-del-estado">Definir el Árbol Bajo un Proceso de Diversificación Dependiente del Estado</h2>
<div class="sourceCode" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>timetree <span class="sc">~</span> <span class="fu">dnCDBDP</span>( <span class="at">rootAge =</span> root, <span class="at">speciationRates =</span> speciation, <span class="at">extinctionRates =</span> extinction, <span class="at">Q =</span> rate_matrix, <span class="at">delta =</span> <span class="fl">1.0</span>, <span class="at">pi =</span> rate_category_prior, <span class="at">rho =</span> rho, <span class="at">condition =</span> <span class="st">"survival"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>✔️ <strong>Parámetros clave:</strong></p>
<ul>
<li><p><strong><code>rootAge = root</code></strong> → La edad de la raíz se fija a la edad del árbol observado.</p></li>
<li><p><strong><code>speciationRates = speciation</code></strong> → Tasas de especiación combinadas (<code>λ</code>), que incluyen efectos de los estados ocultos.</p></li>
<li><p><strong><code>extinctionRates = extinction</code></strong> → Tasas de extinción combinadas (<code>μ</code>), modeladas de la misma manera.</p></li>
<li><p><strong><code>Q = rate_matrix</code></strong> → Matriz de tasas de transición entre estados (<code>0A ↔︎ 1A</code>, <code>0B ↔︎ 1B</code>, etc.).</p></li>
<li><p><strong><code>delta = 1.0</code></strong> → Modelo estándar en el que las tasas de diversificación dependen completamente del estado.</p></li>
<li><p><strong><code>pi = rate_category_prior</code></strong> → Prior de las probabilidades de estado en la raíz.</p></li>
<li><p><strong><code>rho = rho</code></strong> → Ajuste por sesgo de muestreo de especies.</p></li>
<li><p><strong><code>condition = "survival"</code></strong> → Se modela solo en árboles que han sobrevivido hasta el presente.</p></li>
</ul>
</section>
<section id="ajustar-el-modelo-a-la-filogenia-observada" class="level2">
<h2 class="anchored" data-anchor-id="ajustar-el-modelo-a-la-filogenia-observada">Ajustar el Modelo a la Filogenia Observada</h2>
<div class="sourceCode" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">timetree.clamp</span>(T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="ajustar-el-modelo-a-los-datos-de-caracteres" class="level2">
<h2 class="anchored" data-anchor-id="ajustar-el-modelo-a-los-datos-de-caracteres">Ajustar el Modelo a los Datos de Caracteres</h2>
<div class="sourceCode" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">timetree.clampCharData</span>(data_exp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="definir-el-modelo-en-revbayes" class="level2">
<h2 class="anchored" data-anchor-id="definir-el-modelo-en-revbayes">Definir el Modelo en RevBayes</h2>
<div class="sourceCode" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>mymodel <span class="ot">=</span> <span class="fu">model</span>(rate_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="configurar-monitores-para-guardar-resultados" class="level2">
<h2 class="anchored" data-anchor-id="configurar-monitores-para-guardar-resultados"><strong>Configurar Monitores para Guardar Resultados</strong></h2>
<div class="sourceCode" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Monitor Principal del Modelo</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">monitors.append</span>( <span class="fu">mnModel</span>(<span class="at">filename=</span><span class="st">"../out/Hisse/mitos_HiSSE_clyttini_TUTscript.log"</span>, <span class="at">printgen=</span><span class="dv">1</span>) )</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Monitor de Estados Ancestrales</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">monitors.append</span>(<span class="fu">mnJointConditionalAncestralState</span>(<span class="at">tree=</span>timetree, <span class="at">cdbdp=</span>timetree, <span class="at">type=</span><span class="st">"NaturalNumbers"</span>, <span class="at">printgen=</span><span class="dv">1</span>, <span class="at">withTips=</span>true, <span class="at">withStartStates=</span>false, <span class="at">filename=</span><span class="st">"../out/Hisse/anc_states_mitos_HiSSE_clyttini_TUTscript.log"</span>))</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Monitor de Mapeo Estocástico de Caracteres</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="fu">monitors.append</span>(<span class="fu">mnStochasticCharacterMap</span>(<span class="at">cdbdp=</span>timetree, <span class="at">printgen=</span><span class="dv">10</span>, <span class="at">filename=</span><span class="st">"../out/Hisse/stoch_char_map_mitos_HiSSE_clyttini_TUTscript.log"</span>, <span class="at">include_simmap=</span>true))</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Monitor en Pantalla</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="fu">monitors.append</span>(<span class="fu">mnScreen</span>(<span class="at">printgen=</span><span class="dv">10</span>, speciation_observed, extinction_observed))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="configurar-el-algoritmo-mcmc" class="level2">
<h2 class="anchored" data-anchor-id="configurar-el-algoritmo-mcmc">Configurar el Algoritmo MCMC</h2>
<div class="sourceCode" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="do">### workspace mcmc</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>mymcmc <span class="ot">=</span> <span class="fu">mcmc</span>(mymodel, monitors, moves, <span class="at">nruns=</span><span class="dv">1</span>, <span class="at">moveschedule=</span><span class="st">"random"</span>, <span class="at">combine=</span><span class="st">"mixed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="ejecutar-el-mcmc-1" class="level2">
<h2 class="anchored" data-anchor-id="ejecutar-el-mcmc-1">Ejecutar el MCMC</h2>
<div class="sourceCode" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mymcmc.run</span>(<span class="at">generations=</span><span class="dv">400</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="cargar-la-trazabilidad-de-los-estados-ancestrales" class="level2">
<h2 class="anchored" data-anchor-id="cargar-la-trazabilidad-de-los-estados-ancestrales">Cargar la Trazabilidad de los Estados Ancestrales</h2>
<div class="sourceCode" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>anc_states2 <span class="ot">=</span> <span class="fu">readAncestralStateTrace</span>(<span class="st">"../out/Hisse/anc_states_mitos_HiSSE_clyttini_TUTscript.log"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="construcción-del-árbol-con-estados-ancestrales" class="level2">
<h2 class="anchored" data-anchor-id="construcción-del-árbol-con-estados-ancestrales">Construcción del Árbol con Estados Ancestrales</h2>
<div class="sourceCode" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>anc_tree <span class="ot">=</span> <span class="fu">ancestralStateTree</span>(<span class="at">tree=</span>T, <span class="at">ancestral_state_trace_vector =</span> anc_states2, <span class="at">include_start_states=</span>false, <span class="at">file =</span> <span class="st">"../out/Hisse/anc_states_mitos_HiSSE_clyttini_TUTscript.tree"</span>, <span class="at">burnin =</span> <span class="dv">2</span>, <span class="at">summary_statistic =</span> <span class="st">"MAP"</span>, <span class="at">site=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="definir-parámetros-para-la-resumir-estados-ancestrales" class="level2">
<h2 class="anchored" data-anchor-id="definir-parámetros-para-la-resumir-estados-ancestrales">Definir Parámetros para la Resumir Estados Ancestrales</h2>
<div class="sourceCode" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>burnin<span class="ot">=</span><span class="dv">10</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>n_time_slices <span class="ot">=</span> <span class="dv">500</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>✅ <strong><code>burnin = 25</code></strong> → Descarta las <strong>primeras 25 iteraciones</strong> del MCMC antes de hacer el resumen.<br>
✅ <strong><code>n_time_slices = 500</code></strong> → Divide el árbol en <strong>500 segmentos de tiempo</strong> para interpolar los cambios de estado.</p>
</section>
<section id="leer-la-historia-del-carácter-inferida-por-mapeo-estocástico" class="level2">
<h2 class="anchored" data-anchor-id="leer-la-historia-del-carácter-inferida-por-mapeo-estocástico">Leer la Historia del Carácter Inferida por Mapeo Estocástico</h2>
<div class="sourceCode" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>anc_states_SCHM <span class="ot">=</span> <span class="fu">readAncestralStateTrace</span>(<span class="st">"../out/Hisse/stoch_char_map_mitos_HiSSE_clyttini_TUTscript.log"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="crear-el-árbol-de-mapeo-estocástico-de-caracteres" class="level2">
<h2 class="anchored" data-anchor-id="crear-el-árbol-de-mapeo-estocástico-de-caracteres">Crear el Árbol de Mapeo Estocástico de Caracteres</h2>
<div class="sourceCode" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>char_map_tree <span class="ot">=</span> <span class="fu">characterMapTree</span>(<span class="at">tree=</span>T, </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ancestral_state_trace_vector=</span>anc_states_SCHM, </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">character_file=</span><span class="st">"../out/Hisse/stoch_mitos_HiSSE_clyttini_TUTscriptmarginal_char.tree"</span>, </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">posterior_file=</span><span class="st">"../out/Hisse/stoch_mitos_HiSSE_clyttini_TUTscriptmarginal_post.tree"</span>, </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">burnin=</span>burnin, </span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">num_time_slices=</span>n_time_slices)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="visualización-en-r-con-revgadgets-1" class="level2">
<h2 class="anchored" data-anchor-id="visualización-en-r-con-revgadgets-1">Visualización en R con RevGadgets</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar el archivo de estados ancestrales</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>hisse_file <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"../docs/u1_PatDiv/output/hisse/anc_states_mitos_HiSSE_clyttini_TUTscript.tree"</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>p_anc_hisse <span class="ot">&lt;-</span> <span class="fu">processAncStates</span>(hisse_file)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir paleta de colores personalizada</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>traitcols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#F29494"</span>, <span class="st">"#5FD9D9"</span>, <span class="st">"#9DD962"</span>, <span class="st">"#D48DF2"</span>)  <span class="co"># Rojo para estado 0, azul para estado 1</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Generar el gráfico con estados ancestrales</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>plot_hisse <span class="ot">&lt;-</span> <span class="fu">plotAncStatesMAP</span>(p_anc_hisse,</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">tree_layout =</span> <span class="st">"rect"</span>,</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">tip_labels_size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Aplicar la paleta de colores</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_color_manual</span>(<span class="at">values =</span> traitcols) <span class="sc">+</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> traitcols) <span class="sc">+</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Modificar leyenda y otros elementos de ggplot2</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.85</span>),</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">'cm'</span>), <span class="co"># Tamaño de la clave de la leyenda</span></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>), <span class="co"># Tamaño del título de la leyenda</span></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">4</span>))  <span class="co"># Tamaño del texto de la leyenda</span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar el gráfico</span></span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>plot_hisse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="u1_intro_diversification_4_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generar el gráfico con ramas coloreadas por estado ancestral</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>plot_hisse_2 <span class="ot">&lt;-</span> <span class="fu">ggtree</span>(p_anc_hisse, <span class="at">layout =</span> <span class="st">"rectangular"</span>, <span class="fu">aes</span>(<span class="at">color =</span> anc_state_1)) <span class="sc">+</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estado"</span>, <span class="at">values =</span> traitcols) <span class="sc">+</span>  </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"HISSE"</span>) <span class="sc">+</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.85</span>),</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">'cm'</span>), <span class="co"># Tamaño de la clave de la leyenda</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>), <span class="co"># Tamaño del título de la leyenda</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">4</span>))  <span class="co"># Tamaño del texto de la leyenda</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar el gráfico</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>plot_hisse_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="u1_intro_diversification_4_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="graficar-las-tasas-de-diversificación-neta-1" class="level2">
<h2 class="anchored" data-anchor-id="graficar-las-tasas-de-diversificación-neta-1">Graficar las tasas de diversificación neta</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Leer el archivo de salida de RevBayes</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>hisse <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"../docs/u1_PatDiv/output/hisse/mitos_HiSSE_clyttini_TUTscript.log"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir paleta de colores personalizada</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>traitcols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#F29494"</span>, <span class="st">"#5FD9D9"</span>, <span class="st">"#9DD962"</span>, <span class="st">"#D48DF2"</span>)  <span class="co"># Rojo para estado 0, azul para estado 1</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular la tasa de diversificación neta: especiación - extinción</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>netdiversification_rates <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">dens =</span> <span class="fu">c</span>(hisse<span class="sc">$</span>speciation_observed.<span class="fl">1.</span> <span class="sc">-</span> hisse<span class="sc">$</span>extinction_observed.<span class="fl">1.</span>,</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>           hisse<span class="sc">$</span>speciation_observed.<span class="fl">2.</span> <span class="sc">-</span> hisse<span class="sc">$</span>extinction_observed.<span class="fl">2.</span>,</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>           hisse<span class="sc">$</span>speciation_hidden.<span class="fl">1.</span> <span class="sc">-</span> hisse<span class="sc">$</span>extinction_hidden.<span class="fl">1.</span>,</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>           hisse<span class="sc">$</span>speciation_hidden.<span class="fl">2.</span> <span class="sc">-</span> hisse<span class="sc">$</span>extinction_hidden.<span class="fl">2.</span>),</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">rate =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"0A"</span>, <span class="st">"1A"</span>, <span class="st">"0B"</span>, <span class="st">"1B"</span>), <span class="at">each =</span> <span class="fu">length</span>(hisse<span class="sc">$</span>speciation_observed.<span class="fl">1.</span>))</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir la variable de estado en factor</span></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>netdiversification_rates<span class="sc">$</span>rate <span class="ot">&lt;-</span> <span class="fu">factor</span>(netdiversification_rates<span class="sc">$</span>rate, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"0A"</span>, <span class="st">"1A"</span>, <span class="st">"0B"</span>, <span class="st">"1B"</span>))</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear el gráfico de violín para tasas de diversificación neta</span></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>violin_diversification <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(netdiversification_rates, <span class="fu">aes</span>(<span class="at">x =</span> rate, <span class="at">y =</span> dens, <span class="at">fill =</span> rate)) <span class="sc">+</span></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">trim =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Tasas de Diversificación Neta"</span>, <span class="at">x =</span> <span class="st">"Estado"</span>, <span class="at">y =</span> <span class="st">"Tasa"</span>) <span class="sc">+</span></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Estado"</span>, <span class="at">values =</span> traitcols) <span class="sc">+</span></span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar la gráfica</span></span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a>violin_diversification</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="u1_intro_diversification_4_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="graficar-tasas-de-especiación-1" class="level2">
<h2 class="anchored" data-anchor-id="graficar-tasas-de-especiación-1">Graficar tasas de especiación</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear un dataframe con tasas de especiación para cada estado</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>speciation_rates <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dens =</span> <span class="fu">c</span>(hisse<span class="sc">$</span>speciation_observed.<span class="fl">1.</span>,  hisse<span class="sc">$</span>speciation_observed.<span class="fl">2.</span>,</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>           hisse<span class="sc">$</span>speciation_hidden.<span class="fl">1.</span>, hisse<span class="sc">$</span>speciation_hidden.<span class="fl">2.</span>), </span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">rate =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"0A"</span>, <span class="st">"1A"</span>, <span class="st">"0B"</span>, <span class="st">"1B"</span>), <span class="at">each =</span> <span class="fu">length</span>(hisse<span class="sc">$</span>speciation_observed.<span class="fl">1.</span>))</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear gráfico de violín para las tasas de especiación</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>violin_speciation <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(speciation_rates, <span class="fu">aes</span>(<span class="at">x =</span> rate, <span class="at">y =</span> dens, <span class="at">fill =</span> rate)) <span class="sc">+</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">trim =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Tasas de Especiación"</span>, <span class="at">x =</span> <span class="st">"Estado"</span>, <span class="at">y =</span> <span class="st">"Tasa de Especiación"</span>) <span class="sc">+</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Estado"</span>, <span class="at">values =</span> traitcols) <span class="sc">+</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar la gráfica</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>violin_speciation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="u1_intro_diversification_4_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="graficar-tasas-de-extinción-1" class="level2">
<h2 class="anchored" data-anchor-id="graficar-tasas-de-extinción-1">Graficar tasas de extinción</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear un dataframe con tasas de extinción para cada estado</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>extinction_rates <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dens =</span> <span class="fu">c</span>(hisse<span class="sc">$</span>extinction_observed.<span class="fl">1.</span>, hisse<span class="sc">$</span>extinction_observed.<span class="fl">2.</span>,</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>           hisse<span class="sc">$</span>extinction_hidden.<span class="fl">1.</span>, hisse<span class="sc">$</span>extinction_hidden.<span class="fl">2.</span>), </span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">rate =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"0A"</span>, <span class="st">"1A"</span>, <span class="st">"0B"</span>, <span class="st">"1B"</span>), <span class="at">each =</span> <span class="fu">length</span>(hisse<span class="sc">$</span>extinction_observed.<span class="fl">1.</span>))</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear gráfico de violín para tasas de extinción</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>violin_extinction <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(extinction_rates, <span class="fu">aes</span>(<span class="at">x =</span> rate, <span class="at">y =</span> dens, <span class="at">fill =</span> rate)) <span class="sc">+</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">trim =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Tasas de Extinción"</span>, <span class="at">x =</span> <span class="st">"Estado"</span>, <span class="at">y =</span> <span class="st">"Tasa de Extinción"</span>) <span class="sc">+</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Estado"</span>, <span class="at">values =</span> traitcols) <span class="sc">+</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar la gráfica</span></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>violin_extinction</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="u1_intro_diversification_4_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/u1_intro_diversification_3.html" class="pagination-link" aria-label="Estimación de Eventos de Extinción Masiva">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Estimación de Eventos de Extinción Masiva</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/u2_intro_biogeography_1.html" class="pagination-link" aria-label="Introducción a la biogeografía filogenética con el modelo DEC">
        <span class="nav-page-text"><span class="chapter-title">Introducción a la biogeografía filogenética con el modelo DEC</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>